(function(g){var window=this;'use strict';var mfY=function(N){var h=new g.RE("und",new g.q8("Default","und",!0));h.captionTracks=N.captionTracks;return h},IgK=function(N){return new g.eb(function(h,O){var u=N.length,D=[];
if(u)for(var U=function(C,A){u--;D[C]=A;u==0&&h(D)},d=function(C){O(C)},b,B=0;B<N.length;B++)b=N[B],g.S1q(b,g.Bo(U,B),d);
else h(D)})},sr=function(N){this.G=N},JH=function(){sr.apply(this,arguments)},tKm=function(){JH.apply(this,arguments)},$fj=function(){JH.apply(this,arguments)},yXm=function(){JH.apply(this,arguments)},VKn=function(){JH.apply(this,arguments)},Rix=function(){JH.apply(this,arguments)},PBY=function(){JH.apply(this,arguments)},MK4=function(){JH.apply(this,arguments)},p7Y=function(){sr.apply(this,arguments)},eiS=function(){JH.apply(this,arguments)},Exj=function(){JH.apply(this,arguments)},cXr=function(){JH.apply(this,
arguments)},agY=function(){JH.apply(this,arguments)},qt5=function(){JH.apply(this,arguments)},gxS=function(){JH.apply(this,arguments)},rXr=function(){JH.apply(this,arguments)},szY=function(){JH.apply(this,arguments)},JXY=function(){JH.apply(this,arguments)},jzo=function(){JH.apply(this,arguments)},Stm=function(){JH.apply(this,arguments)},HUj=function(){JH.apply(this,arguments)},Tp5=function(){sr.apply(this,arguments)},W_r=function(){JH.apply(this,arguments)},X7Y=function(){JH.apply(this,arguments)},
fgo=function(){JH.apply(this,arguments)},Ytn=function(){JH.apply(this,arguments)},lg5=function(){JH.apply(this,arguments)},xfY=function(){JH.apply(this,arguments)},nx5=function(){JH.apply(this,arguments)},F_x=function(){JH.apply(this,arguments)},ZUn=function(){JH.apply(this,arguments)},kvm=function(){sr.apply(this,arguments)},NmS=function(){sr.apply(this,arguments)},hfr=function(){sr.apply(this,arguments)},O2S=function(){JH.apply(this,arguments)},u9x=function(){JH.apply(this,arguments)},D9R=function(){JH.apply(this,
arguments)},U9Y=function(){JH.apply(this,arguments)},d9S=function(){JH.apply(this,arguments)},Gsx=function(){JH.apply(this,arguments)},b2j=function(){JH.apply(this,arguments)},i2V=function(){JH.apply(this,arguments)},Bm4=function(){JH.apply(this,arguments)},CHV=function(){JH.apply(this,arguments)},Asx=function(){JH.apply(this,arguments)},oGR=function(){JH.apply(this,arguments)},Q0Y=function(){JH.apply(this,arguments)},Lmm=function(){JH.apply(this,arguments)},zfj=function(){JH.apply(this,arguments)},
vGx=function(){JH.apply(this,arguments)},wOo=function(){JH.apply(this,arguments)},KmK=function(){JH.apply(this,arguments)},m9S=function(){JH.apply(this,arguments)},ITS=function(){JH.apply(this,arguments)},tbo=function(){JH.apply(this,arguments)},$94=function(){JH.apply(this,arguments)},ysS=function(){JH.apply(this,arguments)},VbV=function(){JH.apply(this,arguments)},Rfr=function(){JH.apply(this,arguments)},PH4=function(){JH.apply(this,arguments)},Mbx=function(){JH.apply(this,arguments)},pO5=function(){sr.apply(this,
arguments)},efj=function(){JH.apply(this,arguments)},EGr=function(){JH.apply(this,arguments)},csn=function(){JH.apply(this,arguments)},aTY=function(){JH.apply(this,arguments)},q2r=function(){JH.apply(this,arguments)},gGn=function(){JH.apply(this,arguments)},rsR=function(){JH.apply(this,arguments)},s0n=function(){JH.apply(this,arguments)},Js4=function(){JH.apply(this,arguments)},j0S=function(){JH.apply(this,arguments)},S25=function(){JH.apply(this,arguments)},H2n=function(){JH.apply(this,arguments)},
Tmn=function(){JH.apply(this,arguments)},WmY=function(){JH.apply(this,arguments)},XO5=function(){JH.apply(this,arguments)},fTS=function(){JH.apply(this,arguments)},Y2Y=function(){JH.apply(this,arguments)},lT4=function(){JH.apply(this,arguments)},x94=function(){JH.apply(this,arguments)},nGY=function(){JH.apply(this,arguments)},FmY=function(){JH.apply(this,arguments)},Z2R=function(){JH.apply(this,arguments)},ks5=function(){JH.apply(this,arguments)},NiY=function(){JH.apply(this,arguments)},hBY=function(){JH.apply(this,
arguments)},OmY=function(){JH.apply(this,arguments)},uIV=function(){JH.apply(this,arguments)},DZr=function(){JH.apply(this,arguments)},UZr=function(){JH.apply(this,arguments)},dZK=function(){JH.apply(this,arguments)},GjK=function(){JH.apply(this,arguments)},bmV=function(){JH.apply(this,arguments)},imn=function(){JH.apply(this,arguments)},Bin=function(){JH.apply(this,arguments)},CTR=function(N){N=N.key||N.id;
if(!N)throw Error("Entity key is missing");return N},AzY=function(){if(ju)return ju();
var N={};ju=g.F$("PersistentEntityStoreDb",{YQ:(N.EntityStore={Ia:1},N.EntityAssociationStore={Ia:2},N),shared:!1,upgrade:function(h,O){O(1)&&g.En(g.VG(h,"EntityStore",{keyPath:"key"}),"entityType","entityType");O(2)&&(h=g.VG(h,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.En(h,"byParentEntityKey","parentEntityKey"),g.En(h,"byChildEntityKey","childEntityKey"))},
version:3});return ju()},o14=function(N){return g.j9(AzY(),N)},QGo=function(N){return g.j9((0,g.xrS)(),N)},Su=function(N){this.token=N},Hu=function(N,h){h=h===void 0?{}:h;
g.H5.call(this,g.nZV[N],Object.assign({},{name:"PESEncoderError",type:N},h));this.type=N;this.level="WARNING";Object.setPrototypeOf(this,Hu.prototype)},Ln5=function(N){return new Hu("WRONG_DATA_TYPE",{N6:N})},zBS=function(N){return N instanceof Error?new Hu("UNKNOWN_ENCODE_ERROR",{originalMessage:N.message}):new Hu("UNKNOWN_ENCODE_ERROR")},v1Y=function(N){return N instanceof Error?new Hu("UNKNOWN_DECODE_ERROR",{originalMessage:N.message}):new Hu("UNKNOWN_DECODE_ERROR")},wvV=function(N,h){N=N instanceof
Hu?N:h(N);
g.Ms(N);throw N;},KnS=function(){},mZ5=function(N,h,O){try{return N.U(h,O)}catch(u){wvV(u,zBS)}},IJx=function(N){N=(new TextEncoder).encode(N).subarray(0,16);
var h=new Uint8Array(16);h.set(N);return h},TO=function(N){this.G=N},$Zm=function(N){var h=tWR[N];
if(h)return h;g.pX(new g.H5("Entity model not found.",{entityType:N}))},yz5=function(N,h){this.G=N;
this.W=h;this.U={}},RB5=function(N,h){a:{N=VWS(N.W,h.version);
try{var O=N.W(h.data,h.key);break a}catch(u){wvV(u,v1Y)}O=void 0}return O},Wu=function(N,h,O){return N.G.objectStore("EntityStore").get(h).then(function(u){if(u){if(O&&u.entityType!==O)throw Error("Incorrect entity type");
return RB5(N,u)}})},Xd=function(N,h,O){return O?(O=O.map(function(u){return Wu(N,u,h)}),g.w_.all(O)):N.G.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(h)).then(function(u){return u.map(function(D){return RB5(N,D)})})},Y2=function(N,h,O){var u=CTR(h),D=VWS(N.W,1),U=Object.assign({},h);
return N.G.objectStore("EntityStore").get(u).then(function(d){if(d){if(d.entityType!==O)throw Error("Incorrect entity type");U.entityMetadata||(d=RB5(N,d),U.entityMetadata=d.entityMetadata)}}).then(function(){var d={key:u,
entityType:O,data:mZ5(D,U,u),version:1};return g.w_.all([g.My(N.G.objectStore("EntityStore"),d),PTS(N,U,O)])}).then(function(){fi(N,u,O);
return u})},MWR=function(N,h,O){h=h.map(function(u){return Y2(N,u,O)});
return g.w_.all(h)},lj=function(N,h,O){if(O==null?0:O.yX){var u=new Set;
return pv5(N,h,u).then(function(){for(var U=[],d=g.I(u),b=d.next();!b.done;b=d.next())U.push(lj(N,b.value));return g.w_.all(U).then(function(){})})}var D=g.n$(h).entityType;
return g.w_.all([N.G.objectStore("EntityStore").delete(h),eBS(N,h)]).then(function(){fi(N,h,D)})},E14=function(N,h){return g.g_(N.G.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(h)},function(O){return g.w_.all([O.delete(),
eBS(N,O.cursor.primaryKey)]).then(function(){fi(N,O.cursor.primaryKey,h);return g.aa(O)})})},czS=function(N,h,O,u){var D=VWS(N.W,1);
return Wu(N,h,u).then(function(U){if(U){U=g.us(U,O);var d={key:h,entityType:u,data:mZ5(D,U,h),version:1};return g.w_.all([g.My(N.G.objectStore("EntityStore"),d),PTS(N,U,u)])}}).then(function(){fi(N,h,u);
return h})},fi=function(N,h,O){var u=N.U[O];
u||(u=new Set,N.U[O]=u);u.add(h)},aJR=function(N,h,O){var u=CTR(h);
O=$Zm(O);if(!O)return g.w_.resolve([]);O=new O(h);N=N.G.objectStore("EntityAssociationStore");h=[];O=g.I(O.W());for(var D=O.next();!D.done;D=O.next())h.push(g.My(N,{parentEntityKey:u,childEntityKey:D.value}));return g.w_.all(h).then(function(U){return U.map(function(d){return d[1]})})},eBS=function(N,h){return N.G.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(h))},PTS=function(N,h,O){var u=CTR(h);
return eBS(N,u).then(function(){return aJR(N,h,O)})},pv5=function(N,h,O){if(O.has(h))return g.w_.resolve(void 0);
O.add(h);return qqo(N,h).then(function(u){return N.G.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(h)).then(function(){return u})}).then(function(u){var D=g.w_.resolve(void 0);
u=g.I(u);for(var U=u.next(),d={};!U.done;d={rK:void 0},U=u.next())d.rK=U.value,D=D.then(function(b){return function(){return pv5(N,b.rK,O)}}(d));
return D}).then(function(){})},qqo=function(N,h){var O=N.G.objectStore("EntityAssociationStore");
return O.index("byParentEntityKey").getAll(IDBKeyRange.only(h)).then(function(u){var D=[];u=g.I(u);for(var U=u.next();!U.done;U=u.next())U=U.value,D.push(O.index("byChildEntityKey").getAll(U.childEntityKey));return g.w_.all(D)}).then(function(u){var D=[];
u=g.I(u);for(var U=u.next();!U.done;U=u.next())U=U.value,U.length===1&&D.push(U[0].childEntityKey);return D})},x2=function(){},g1K=function(){this.G={};
this.G[0]=new x2;if(!g.z8("aes_pes_encoder_killswitch")){var N=this.G;try{var h=g.T4();var O=IJx(h);var u=new TO(new g.AU(O),new g.oB(O))}catch(D){throw N=D instanceof Error?new Hu("KEY_CREATION_FAILED",{originalMessage:D.message}):new Hu("KEY_CREATION_FAILED"),g.Ms(N),N;}N[1]=u}},VWS=function(N,h){h=h===void 0?0:h;
N=N.G[h];if(!N)throw h=new Hu("INVALID_ENCODER_VERSION",{N6:h}),g.Ms(h),h;return N},ni=function(N,h){g.S.call(this);
this.token=N;this.G=h;this.observers=[];N=new g.kp.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.T4());N.onmessage=this.W.bind(this);this.channel=N},Fd=function(N,h,O){var u,D,U,d;
return g.c(function(b){if(b.G==1)return g.E(b,o14(N.token),2);if(b.G!=3)return u=b.W,g.E(b,g.Pe(u,["EntityStore","EntityAssociationStore"],h,function(B){D=new yz5(B,N.G);return O(D)}),3);
U=b.W;D&&(d=D.U,Object.keys(d).length>0&&(N.channel.postMessage(d),rzR(N,d)));return b.return(U)})},Z5=function(N,h,O){return Fd(N,{mode:"readwrite",
hd:!0},function(u){return Y2(u,h,O)})},sGj=function(N,h){return Fd(N,{mode:"readwrite",
hd:!0},function(O){return MWR(O,h,"offlineOrchestrationActionWrapperEntity")})},Jzr=function(N,h){return Fd(N,{mode:"readwrite",
hd:!0},function(O){return lj(O,h)})},jGo=function(N){return Fd(N,{mode:"readwrite",
hd:!0},function(h){return E14(h,"videoPlaybackPositionEntity")})},k2=function(N,h,O){return Fd(N,{mode:"readonly",
hd:!0},function(u){return Wu(u,h,O)})},NW=function(N,h,O){return Fd(N,{mode:"readonly",
hd:!0},function(u){return Xd(u,h,O)})},rzR=function(N,h){N=g.I(N.observers);
for(var O=N.next();!O.done;O=N.next())O=O.value,O(h)},Sqm=function(){var N,h,O;
return g.c(function(u){if(u.G==1)return g.Vy(u,2),g.E(u,g.xT(),4);if(u.G!=2){N=u.W;if(!N||!g.W5()||typeof g.kp.BroadcastChannel==="undefined")return u.return();h=new g1K;return u.return(new ni(N,h))}O=g.eo(u);O instanceof Error&&g.Ms(O);return u.return()})},hy=function(){HmY||(HmY=Sqm());
return HmY},TiY=function(N){var h;
N=(h=N.options)==null?void 0:h.persistenceOption;return N==="ENTITY_PERSISTENCE_OPTION_PERSIST"||N==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},WnR=function(N){var h;
return g.c(function(O){return O.G==1?g.E(O,hy(),2):(h=O.W)?g.E(O,Fd(h,"readwrite",function(u){for(var D={},U=g.I(N),d=U.next(),b={};!d.done;b={VV:void 0,DZ:void 0},d=U.next())b.VV=d.value,b.VV.entityKey&&TiY(b.VV)&&(b.DZ=g.ul(b.VV.payload),d=void 0,b.VV.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(d=function(B){return function(){return Y2(u,B.VV.payload[B.DZ],B.DZ)}}(b)),b.VV.type==="ENTITY_MUTATION_TYPE_DELETE"&&(d=function(B){return function(){return lj(u,B.VV.entityKey)}}(b)),b.VV.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(d=function(B){return function(){return czS(u,B.VV.entityKey,B.VV.payload[B.DZ],B.DZ)}}(b)),d&&(D[b.VV.entityKey]=D[b.VV.entityKey]?D[b.VV.entityKey].then(d):d()));
return g.w_.all(Object.values(D))}),0):O.return()})},Xvm=function(N){var h;
return g.c(function(O){if(O.G==1){h=N.mutations;if(!h||h.length<=0)return O.return();if(g.Mi){var u={type:"ENTITY_LOADED"};h!==void 0&&(u.payload=h);g.Mi.dispatch(u)}return g.E(O,WnR(h),2)}h.length=0;g.yy(O)})},fJx=function(N){return N!==void 0},Yq4=function(N){var h=g.Dt();
h=Object.assign({},h);N=Object.assign({},N);for(var O in h)N[O]?(h[O]!==4&&(h[O]=N[O]),delete N[O]):h[O]!==2&&(h[O]=4);Object.assign(h,N);g.XEZ(h);JSON.stringify(h);return h},lJY=function(N){var h,O;
return g.c(function(u){if(u.G==1)return g.E(u,g.xT(),2);if(u.G!=3)return(h=u.W)?g.E(u,g.Gd(h),3):u.return();O=u.W;return u.return(g.Pe(O,["index","media","captions"],{mode:"readwrite",hd:!0},function(D){var U=IDBKeyRange.bound(N+"|",N+"~");D=[D.objectStore("index").delete(U),D.objectStore("media").delete(U),D.objectStore("captions").delete(U)];return g.w_.all(D).then(function(){})}))})},xZ4=function(){var N,h;
return g.c(function(O){if(O.G==1)return g.E(O,g.xT(),2);if(O.G!=3){N=O.W;if(!N)throw g.zg("rvdfd");return g.E(O,g.Gd(N),3)}h=O.W;return O.return(g.Pe(h,["index","media"],{mode:"readwrite",hd:!0},function(u){var D={};return g.ce(u.objectStore("index"),{},function(U){var d=U.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),b=g.w_.resolve(void 0);if(d){var B=d[1];d=d[2];D[B]=D[B]||{};var C;D[B][d]=g.nOq((C=U.getValue())==null?void 0:C.fmts)}else b=U.delete().then(function(){});
return g.w_.all([g.aa(U),b]).then(function(A){return g.I(A).next().value})}).then(function(){for(var U={},d=g.I(Object.keys(D)),b=d.next();!b.done;b=d.next()){b=b.value;
var B=D[b].v;U[b]=D[b].a&&B?1:2}var C=Yq4(U);return g.VDq(u.objectStore("media"),{},function(A){var Q=A.cursor.key.match(g.NaZ);Q&&U[Q[1]]||u.objectStore("media").delete(A.cursor.key);return g.zvp(A)}).then(function(){return C})})}))})},n1o=function(N,h){var O,u;
return g.c(function(D){if(D.G==1)return g.E(D,g.xT(),2);if(D.G!=3){O=D.W;if(!O)throw g.zg("wct");return g.E(D,g.Gd(O),3)}u=D.W;return g.E(D,g.Pe(u,["captions"],{mode:"readwrite",hd:!0},function(U){var d=[];U=U.objectStore("captions");for(var b=0;b<h.length;b++){var B=g.My(U,h[b],N+"|"+h[b].metadata.vss_id);d.push(B)}return g.w_.all(d)}),0)})},Fno=function(N){var h,O,u;
return g.c(function(D){if(D.G==1)return h=IDBKeyRange.bound(N+"|",N+"~"),g.E(D,g.xT(),2);if(D.G!=3){O=D.W;if(!O)throw g.zg("gactfv");return g.E(D,g.Gd(O),3)}u=D.W;return D.return(u.getAll("captions",h))})},ZmV=function(N){return g.c(function(h){g.dZ(N,0);
return h.return(lJY(N))})},kjm=function(N){return{context:g.x5(),
videoIds:N}},NOY=function(N){return{context:g.x5(),
playlistIds:N}},hvn=function(N){return{context:g.x5(),
offlinePlaylistSyncChecks:N}},Ozj=function(){this.G=new Map},Dmr=function(){ui4||(ui4=new Ozj);
return ui4},UmS=function(N,h){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:N},metadata:h,statusCode:void 0,csn:void 0,can:void 0}},dmV=function(N,h,O){if(!O){var u=u===void 0?!1:u;
O=N.G.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!O||u)O=g.vJ(16),N.G.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",O)}N={flowNonce:O,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:h.eventType};h.metadata&&(N.flowMetadata=h.metadata);h.statusCode!==void 0&&(N.flowEventStatus=h.statusCode);h.csn&&(N.csn=h.csn);h.can&&(N.can=h.can);g.DR("flowEvent",N,void 0)},GxS=function(N){var h,O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY,BR,oe,Oa,Ea,nx,or,CS,fx,ae,Gi,sR,XV,bl,e,Ti;
return g.c(function(ar){if(ar.G==1)return g.E(ar,Fd(N,{mode:"readonly",hd:!0},function(uY){return Xd(uY,"playbackData").then(function(Rr){var y=Rr.map(function(Sx){return Sx.transfer}).filter(function(Sx){return!!Sx}),hd=Rr.map(function(Sx){return Sx.offlineVideoPolicy}).filter(function(Sx){return!!Sx}),PH=Rr.filter(function(Sx){return!!Sx.key}).map(function(Sx){return g.Fv(g.n$(Sx.key).entityId,"downloadStatusEntity")});
y=Xd(uY,"transfer",y);hd=Xd(uY,"offlineVideoPolicy",hd);PH=Xd(uY,"downloadStatusEntity",PH);var nZ=y.then(function(Sx){Sx=Sx.reduce(function(lY,OR){(OR==null?0:OR.offlineVideoStreams)&&lY.push.apply(lY,g.Lx(OR.offlineVideoStreams));return lY},[]).filter(function(lY){return!!lY});
return Xd(uY,"offlineVideoStreams",Sx)});
return g.w_.all([y,hd,nZ,PH]).then(function(Sx){var lY=g.I(Sx);Sx=lY.next().value;var OR=lY.next().value;var Dr=lY.next().value;lY=lY.next().value;return[Rr,Sx,OR,Dr,lY]})})}),2);
if(ar.G!=3)return h=ar.W,g.E(ar,Fd(N,{mode:"readonly",hd:!0},function(uY){return Xd(uY,"mainDownloadsListEntity").then(function(Rr){var y,hd;return(hd=(y=Rr[0])==null?void 0:y.downloads)!=null?hd:[]})}),3);
O=ar.W;u=g.I(h);D=u.next().value;U=u.next().value;d=u.next().value;b=u.next().value;B=u.next().value;C=D;A=U;Q=d;L=b;z=B;v={};t={};R={};p={};M={};a=[];J=g.I(A);for(W=J.next();!W.done;W=J.next())(F=W.value)&&(v[F.key]=F);l=g.I(Q);for(iY=l.next();!iY.done;iY=l.next())(bY=iY.value)&&(t[bY.key]=bY);BR=g.I(z);for(oe=BR.next();!oe.done;oe=BR.next())(Oa=oe.value)&&(R[Oa.key]=Oa);Ea=g.I(L);for(nx=Ea.next();!nx.done;nx=Ea.next())(or=nx.value)&&(p[or.key]=or);CS=g.I(O);for(fx=CS.next();!fx.done;fx=CS.next())ae=
fx.value,Gi=void 0,M[(Gi=ae.videoItem)!=null?Gi:""]=!0,ae.videoItem&&(XV=sR=void 0,bl=(XV=(sR=g.n$(ae.videoItem))==null?void 0:sR.entityId)!=null?XV:"",a.push({externalVideoId:bl}));e=C.filter(function(uY){if(!uY||!uY.key||!uY.offlineVideoPolicy)return!1;uY=g.n$(uY.key).entityId;uY=g.Fv(uY,"downloadStatusEntity");var Rr;return!(uY&&((Rr=R[uY])==null?void 0:Rr.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
Ti=e.map(function(uY){var Rr=v[uY.transfer],y=[];if(Rr==null?0:Rr.offlineVideoStreams)for(var hd=g.I(Rr.offlineVideoStreams),PH=hd.next();!PH.done;PH=hd.next())(PH=p[PH.value])&&y.push(PH);hd=t[uY.offlineVideoPolicy];PH=M;var nZ=uY==null?void 0:uY.playerResponseTimestamp,Sx=g.n$(hd.key).entityId;uY=g.Fv(Sx,"mainVideoEntity");if(hd.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var lY="OFFLINE_VIDEO_STATE_DISABLED";hd.expirationTimestamp&&Number(hd.expirationTimestamp)<Date.now()/1E3&&(lY="OFFLINE_VIDEO_STATE_EXPIRED")}else if(hd.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")lY="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Rr==null?void 0:Rr.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":lY="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":lY="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":lY="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":lY="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":lY="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":lY="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:lY="OFFLINE_VIDEO_STATE_UNKNOWN"}if(lY==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Rr==null?void 0:Rr.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":lY="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":lY="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":lY=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Sx={id:Sx,videoState:lY};if(Rr==null?0:Rr.cotn)Sx.cotn=Rr.cotn;if(Rr==null?0:Rr.maximumDownloadQuality)Sx.selectedVideoQuality=Rr==null?void 0:Rr.maximumDownloadQuality;if(Rr==null?0:Rr.lastProgressTimeMs)Sx.lastProgressTimeMs=Rr.lastProgressTimeMs;nZ&&(Sx.playerResponseSavedTimeMs=String(Number(nZ)*1E3));Rr=String;nZ=0;y=g.I(y);for(lY=y.next();!lY.done;lY=y.next())if(lY=lY.value,lY.streamsProgress){lY=g.I(lY.streamsProgress);for(var OR=lY.next();!OR.done;OR=lY.next()){var Dr=
void 0;nZ+=Number((Dr=OR.value.numBytesDownloaded)!=null?Dr:0)}}Sx.downloadedBytes=Rr(nZ);Sx.selectedOfflineMode=PH[uY]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";hd.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Sx.offlinePlaybackDisabledReason=hd.offlinePlaybackDisabledReason);return Sx});
return ar.return({offlineVideos:Ti,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:a}}})})},bzS=function(){this.locks=navigator.locks},izY=function(){try{var N=g.hj("ytglobal.locks_");
if(N)return N;var h;if(h=navigator){var O=navigator;h="locks"in O&&!!O.locks}if(h)return g.kp.localStorage&&g.kp.localStorage.getItem("noop"),N=new bzS,g.N5("ytglobal.locks_",N),N}catch(u){}},O6=function(){},BOn=function(){},Cax=function(N){if(N.includes(":"))throw Error("Invalid user cache name: "+N);
return N+":"+g.T4("CacheStorage get")},A04=function(){return g.c(function(N){if(uJ!==void 0)return N.return(uJ);
uJ=new Promise(function(h){var O;return g.c(function(u){switch(u.G){case 1:return g.Vy(u,2),g.E(u,Dk.open("test-only"),4);case 4:return g.E(u,Dk.delete("test-only"),5);case 5:g.Mt(u,3);break;case 2:if(O=g.eo(u),O instanceof Error&&O.name==="SecurityError")return h(!1),u.return();case 3:h("caches"in window),g.yy(u)}})});
return N.return(uJ)})},Q95=function(){return g.c(function(N){if(N.G==1)return g.E(N,A04(),2);
if(!N.W)return N.return(void 0);oLr||(oLr=new BOn);return N.return(oLr)})},U6=function(N,h,O){g.pX(new g.H5("Woffle: "+N,O?{cotn:O}:""));
h instanceof Error&&g.pX(h)},LDo=function(N){var h;
return g.c(function(O){if(O.G==1)return g.E(O,GxS(N),2);h=O.W;g.DR("offlineStateSnapshot",h);g.yy(O)})},dL=function(N){g.S.call(this);
var h=this;this.api=N;this.KF={Px$:function(){return h.G},
eNC:function(){return h.W}};
typeof g.kp.BroadcastChannel!=="undefined"&&(this.G=new g.kp.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.T4()),this.G.onmessage=this.U.bind(this),this.W=new g.kp.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.T4()),this.W.onmessage=this.X.bind(this))},Gr=function(N,h){N.api.wf("onOfflineOperationFailure",h);
var O;(O=N.G)==null||O.postMessage(h)},zvY=function(N,h,O){var u=this;
this.Y=N;this.D=h;this.visibility=O;this.L=this.B=this.V=this.U=this.G=!1;this.X=new g.YL(function(){u.Ws()});
this.KF={i8:function(){return u.W},
Ws:function(){u.Ws()},
UuA:function(){return u.X}};
this.visibility.subscribe("visibilitystatechange",function(){u.Aw()})},vLY=function(N){if(!N.U&&!N.G){var h=izY();
if(h){N.U=!0;var O=g.T4("OfflineLockManager");h.request("woffle_orchestration_leader:"+O,{},function(){var u,D;return g.c(function(U){switch(U.G){case 1:return g.Vy(U,2),N.W=new g.oG,N.G=!0,N.U=!1,g.E(U,N.Y(),4);case 4:return g.E(U,N.W.promise,5);case 5:g.Mt(U,0);break;case 2:u=g.eo(U),N.Ws(),u instanceof Error&&(D=u,D.args=[{name:"WoLockManagerError",H_:u.name}],g.Ms(D)),g.yy(U)}})})}}},w8r=function(N){N.G&&(N.L=!0,bJ(N))},KDK=function(N,h){N.G&&(N.V=h,bJ(N))},mmx=function(N,h){N.G&&(N.B=h,bJ(N))},
bJ=function(N){N.B&&N.V&&N.L&&N.visibility.isBackground()?g.la(N.X,6E4):N.X.stop()},iJ=function(N){var h;
N.offlineDeleteReason=(h=N.offlineDeleteReason)!=null?h:"OFFLINE_DELETE_REASON_UNKNOWN";var O;N.offlineModeType=(O=N.offlineModeType)!=null?O:"OFFLINE_NOW";g.DR("offlineDeleteEvent",N)},Bf=function(N,h){var O=h.videoId;
var u=h.w9;h=h.offlineModeType;N.encryptedVideoId=O;N.cotn=u==null?void 0:u.cotn;N.offlineabilityFormatType=u==null?void 0:u.maximumDownloadQuality;var D;N.isRefresh=(D=u==null?void 0:u.isRefresh)!=null?D:!1;var U;N.softErrorCount=(U=u==null?void 0:u.transferRetryCount)!=null?U:0;N.offlineModeType=h!=null?h:"OFFLINE_NOW";(N.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&N.statusType==="UNKNOWN_STATUS_TYPE"||!N.transferStatusType&&!N.statusType)&&g.pX(Error("Woffle unknown transfer status"));
g.DR("offlineTransferStatusChanged",N)},IxY=function(N){Bf({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},N)},tDm=function(N,h,O,u){u={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!u};h&&O&&(h=Math.floor(h/1024).toFixed(),O=Math.floor(O/1024).toFixed(),u.alreadyDownloadedKbytes=h,u.totalFetchedKbytes=h,u.totalContentKbytes=O);Bf(u,N)},$mK=function(N){Bf({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},N)},y0V=function(N){Bf({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},N)},VDm=function(N){switch(N){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Cf=function(N){var h,O,u;
return((u=(h=N.actionMetadata)==null?void 0:(O=h.retryScheduleIntervalsInSeconds)==null?void 0:O.length)!=null?u:0)>0},Ay=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!N.entityKey},oM=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!N.entityKey},Qw=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!N.entityKey},Rvo=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!N.entityKey},
Lf=function(N,h,O,u,D){D=D===void 0?!1:D;
var U,d,b,B,C,A;return g.c(function(Q){if(Q.G==1)return U=g.Fv(N,h),d=g.Fv(N,"downloadStatusEntity"),g.E(Q,Fd(O,{mode:"readonly",hd:!0},function(L){return g.w_.all([Wu(L,U,h),Wu(L,d,"downloadStatusEntity")])}),2);
b=Q.W;B=b.length?b[0]:void 0;if(!B)return Q.l0(0);C=PaS;if(A=b.length>1?b[1]:void 0){if(A.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!D)return Q.return();A.downloadState=u}else A={key:d,downloadState:u};g.qs(B,C,A);return g.E(Q,Fd(O,{mode:"readwrite",hd:!0},function(L){return g.w_.all([Y2(L,B,h),Y2(L,A,"downloadStatusEntity")])}),0)})},zr=function(N,h){return N.actionType===h.actionType&&N.entityKey===h.entityKey},vf=function(N,h){if(N&&N.transferState!=="TRANSFER_STATE_COMPLETE"&&N.transferState!==
"TRANSFER_STATE_FAILED"){var O=g.n$(N.key).entityId;
Bf({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:O,w9:N,offlineModeType:h})}},wL=function(N){if(!N||!N.thumbnails)return[];
var h=[];N=g.I(N.thumbnails);for(var O=N.next();!O.done;O=N.next())O=O.value,O.url&&h.push(O.url);return h},MD4=function(N,h,O){O=O===void 0?[]:O;
var u,D,U,d,b,B,C,A,Q,L,z,v,t;return g.c(function(R){if(R.G==1)return O.length?g.E(R,NW(N,h),2):R.return([]);u=R.W;D=new Set;U=g.I(u);for(d=U.next();!d.done;d=U.next())if(b=d.value,B=b.id||b.key)C=g.n$(B).entityId,D.add(C);A=[];Q=g.I(O);for(L=Q.next();!L.done;L=Q.next())z=L.value,v=z.offlineVideoData,t=void 0,((t=v)==null?0:t.videoId)&&!D.has(v.videoId)&&A.push(z);return R.return(A)})},p8R=function(N,h,O){return new g.KC(N,{cotn:h,
raw_player_response:O,download_media:!0,start:Infinity,disable_watch_next:!0})},evS=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Kf=function(N,h,O,u,D,U,d,b,B,C,A){this.entityType=N;
this.actionId=h;this.action=O;this.parentActionId=u;this.rootActionId=D===void 0?h:D;this.childActionIds=U;this.prereqActionId=d;this.postreqActionIds=b;this.hasChildActionFailed=C;this.retryScheduleIndex=0;this.G=A||Date.now();this.retryScheduleIndex=B||0},mL=function(N){if(!N.key)throw Error("Entity key is required.");
if(!N.actionProto)throw Error("OfflineOrchestrationAction is required.");var h=g.n$(N.key),O=g.n$(N.actionProto.entityKey);return new Kf(O.entityType,h.entityId,N.actionProto,N.parentActionId,N.rootActionId,N.childActionIds,N.prereqActionId,N.postreqActionIds,N.retryScheduleIndex,N.hasChildActionFailed,Number(N.enqueueTimeSec)*1E3)},IM=function(N){return{key:g.Fv(N.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:N.action,parentActionId:N.parentActionId,rootActionId:N.rootActionId,childActionIds:N.childActionIds,prereqActionId:N.prereqActionId,postreqActionIds:N.postreqActionIds,retryScheduleIndex:N.retryScheduleIndex,hasChildActionFailed:N.hasChildActionFailed,enqueueTimeSec:(N.G/1E3).toFixed()}},ELV=function(){var N;
return g.c(function(h){return h.G==1?g.E(h,Q95(),2):(N=h.W)?h.return(N.delete("yt-player-local-img")):h.return(!0)})},ty=function(N){var h,O;
return g.c(function(u){if(u.G==1)return g.E(u,Q95(),2);if(u.G!=3){h=u.W;if(!h)throw Error("Cache API not supported");return N.length?g.E(u,h.open("yt-player-local-img"),3):u.return()}O=u.W;return g.E(u,Promise.all(N.map(function(D){return O.delete(D)})),0)})},$c=function(N){var h,O;
return g.c(function(u){if(u.G==1)return g.E(u,Q95(),2);if(u.G!=3){h=u.W;if(!h)throw Error("Cache API not supported");return N.length?g.E(u,h.open("yt-player-local-img"),3):u.return()}O=u.W;return g.E(u,O.addAll(N),0)})},yw=function(N,h,O,u,D){var U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY,BR,oe,Oa,Ea,nx,or,CS,fx,ae,Gi;
return g.c(function(sR){switch(sR.G){case 1:return U=g.Fv(N,"mainVideoEntity"),d=g.Fv(N,"ytMainChannelEntity"),b=g.Fv(N,"transfer"),B=g.Fv(N,"videoDownloadContextEntity"),g.E(sR,Fd(h,{mode:"readonly",hd:!0},function(XV){return g.w_.all([Wu(XV,U,"mainVideoEntity"),Wu(XV,d,"ytMainChannelEntity"),Wu(XV,b,"transfer"),Wu(XV,B,"videoDownloadContextEntity"),Xd(XV,"ytMainChannelEntity"),Xd(XV,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:C=sR.W;A=g.I(C);Q=A.next().value;L=A.next().value;z=A.next().value;v=A.next().value;t=A.next().value;R=A.next().value;p=Q;M=L;a=z;J=v;W=t;F=R;if(!p&&!M){sR.l0(3);break}l=p?wL(p.thumbnail):[];if(!M){iY=[];sR.l0(4);break}return g.E(sR,c05(M,W),5);case 5:iY=sR.W;case 4:return bY=iY,g.E(sR,ty(l.concat(bY)),3);case 3:BR=[];oe=g.Fv(N,"downloadStatusEntity");Oa=g.I(F);for(Ea=Oa.next();!Ea.done;Ea=Oa.next())nx=Ea.value,or=g.n$(nx.key).entityId,CS=mL(nx),fx=g.n$(CS.action.entityKey).entityId,or!==N&&
fx!==N||zr(O,nx.actionProto)||BR.push(nx.key);return g.E(sR,Fd(h,{mode:"readwrite",hd:!0},function(XV){var bl=BR.map(function(e){return lj(XV,e)});
bl.push(lj(XV,U,{yX:!0}));bl.push(lj(XV,oe,{yX:!0}));return g.w_.all(bl)}),7);
case 7:Gi=(ae=J)==null?void 0:ae.offlineModeType,D&&(iJ(D),D.offlineModeType&&(Gi=D.offlineModeType)),vf(a,Gi),Gr(u,{entityKey:U,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.yy(sR)}})},gLo=function(N,h,O,u){var D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY,BR,oe,Oa,Ea,nx,or,CS,fx,ae,Gi,sR,XV,bl,e,Ti,ar,uY,Rr,y,hd,PH,nZ,Sx,lY,OR,Dr,WH,V;
return g.c(function(m){switch(m.G){case 1:return D=g.Fv(N,"mainPlaylistEntity"),U=g.Fv(N,"ytMainChannelEntity"),g.E(m,Fd(h,{mode:"readonly",hd:!0},function(P){return g.w_.all([Wu(P,D,"mainPlaylistEntity"),Wu(P,U,"ytMainChannelEntity"),Xd(P,"mainPlaylistEntity"),Xd(P,"mainDownloadsListEntity"),Xd(P,"ytMainChannelEntity"),Xd(P,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=m.W;b=g.I(d);B=b.next().value;C=b.next().value;A=b.next().value;Q=b.next().value;L=b.next().value;z=b.next().value;v=B;t=C;R=A;p=Q;M=L;a=z;if(!v&&!t){m.l0(3);break}J=v?ax4(v):[];if(!t){W=[];m.l0(4);break}return g.E(m,c05(t,M),5);case 5:W=m.W;case 4:return F=W,g.E(m,ty(J.concat(F)),3);case 3:l=[];iY=new Map;if(!v){m.l0(7);break}return g.E(m,qhY(v,R,p),8);case 8:l=m.W;bY=g.I(l);for(BR=bY.next();!BR.done;BR=bY.next())oe=BR.value,iY.set(oe,{videoId:oe,playlistId:N,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.E(m,Fd(h,{mode:"readonly",hd:!0},function(P){return g.w_.all([Xd(P,"transfer"),Xd(P,"videoDownloadContextEntity")])}),9);
case 9:Oa=m.W;Ea=g.I(Oa);nx=Ea.next().value;or=Ea.next().value;CS=nx;fx=or;ae=g.I(CS);for(Gi=ae.next();!Gi.done;Gi=ae.next())sR=Gi.value,XV=g.n$(sR.key).entityId,(bl=iY.get(XV))&&sR&&(bl.cotn=sR.cotn);e=g.I(fx);for(Ti=e.next();!Ti.done;Ti=e.next())ar=Ti.value,uY=g.n$(ar.key).entityId,(Rr=iY.get(uY))&&ar&&(Rr.offlineModeType=ar.offlineModeType);case 7:y=[];hd=g.I(a);for(PH=hd.next();!PH.done;PH=hd.next())nZ=PH.value,Sx=g.n$(nZ.key).entityId,lY=mL(nZ),Sx!==N&&lY.rootActionId!==N||zr(O,nZ.actionProto)||
y.push(nZ.key);OR=g.Fv(N,"mainPlaylistEntity");return g.E(m,Fd(h,{mode:"readwrite",hd:!0},function(P){var q=y.map(function(T){return lj(P,T)});
q.push(lj(P,OR,{yX:!0}));return g.w_.all(q)}),10);
case 10:if(!v){m.l0(0);break}l.reverse();if(!l){m.l0(0);break}Dr=g.I(l);WH=Dr.next();case 13:if(WH.done){m.l0(0);break}V=WH.value;return g.E(m,yw(V,h,O,u,iY.get(V)),14);case 14:WH=Dr.next(),m.l0(13)}})},s9r=function(N,h,O,u){var D,U,d,b,B,C,A,Q,L;
return g.c(function(z){if(z.G==1)return D=g.Fv("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),U=new Map,g.E(z,Fd(N,{mode:"readwrite",hd:!0},function(v){var t=Xd(v,"transfer"),R=Xd(v,"offlineOrchestrationActionWrapperEntity"),p=Xd(v,"videoDownloadContextEntity"),M=Wu(v,D,"mainDownloadsListEntity");return g.w_.all([t,R,p,M]).then(function(a){a=g.I(a);var J=a.next().value;var W=a.next().value;var F=a.next().value;var l=a.next().value;a=r0Y.map(function(bY){return E14(v,bY)});
W=g.I(W);for(var iY=W.next();!iY.done;iY=W.next())iY=iY.value,zr(h,iY.actionProto)||a.push(lj(v,iY.key,{yX:!0}));l&&(l.downloads=[],a.push(Y2(v,l,"mainDownloadsListEntity")));if(F)for(F=g.I(F),l=F.next();!l.done;l=F.next())l=l.value,W=g.n$(l.key).entityId,W=g.Fv(W,"transfer"),U.set(W,l.offlineModeType);return g.w_.all(a).then(function(){return J})})}),2);
d=z.W;b=g.I(d);for(B=b.next();!B.done;B=b.next())C=B.value,vf(C,U.get(C.key)),A=g.n$(C.key).entityId,Q={videoId:A,offlineDeleteReason:u,cotn:C.cotn,offlineModeType:U.get(C.key)},iJ(Q),L=g.Fv(A,"mainVideoEntity"),Gr(O,{entityKey:L,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.E(z,ELV(),0)})},ax4=function(N,h){var O=[];
if(N.thumbnailStyleData){N=g.I(N.thumbnailStyleData);for(var u=N.next();!u.done;u=N.next()){var D=void 0,U=void 0,d=void 0;O=O.concat(wL((D=u.value)==null?void 0:(U=D.value)==null?void 0:(d=U.collageThumbnail)==null?void 0:d.coverThumbnail))}}h=wL(h);return O.concat(h)},qhY=function(N,h,O){var u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY;
return g.c(function(BR){u=[];D=new Set;if(O.length)for(U=g.I(O),d=U.next();!d.done;d=U.next())if(b=d.value,B=void 0,(B=b.downloads)==null?0:B.length)for(C=g.I(b.downloads),A=C.next();!A.done;A=C.next())Q=A.value,Q.videoItem&&(L=g.n$(Q.videoItem).entityId,D.add(L));if(N.videos){z=g.I(N.videos);for(v=z.next();!v.done;v=z.next())t=v.value,R=JSON.parse(g.n$(t).entityId),R.videoId&&!D.has(R.videoId)&&u.push(R.videoId);p=g.I(h);for(M=p.next();!M.done;M=p.next())if(a=M.value,a.key!==N.key&&(J=a.videos))for(W=
g.I(J),F=W.next();!F.done;F=W.next())l=F.value,iY=JSON.parse(g.n$(l).entityId),iY.videoId&&(bY=u.indexOf(iY.videoId),bY!==-1&&u.splice(bY,1))}return BR.return(u)})},c05=function(N,h){var O,u,D,U,d,b,B,C;
return g.c(function(A){O=wL(N.avatar);u=g.I(h);for(D=u.next();!D.done;D=u.next())if(U=D.value,U.id!==N.id)for(d=g.I(wL(U.avatar)),b=d.next();!b.done;b=d.next())B=b.value,C=O.indexOf(B),C!==-1&&O.splice(C,1);return A.return(O)})},J0r=function(N){var h;
return g.c(function(O){h=g.X(N.frameworkUpdates,Vw);return N.frameworkUpdates&&h?g.E(O,Xvm(h),0):O.return()})},Shx=function(N){var h;
if((h=N.onResponseReceivedActions)!=null&&h.length){var O;N=(O=g.X(g.X(N.onResponseReceivedActions[0],j9r),g.WqS))==null?void 0:O.actions;if(N!=null&&N.length)return N}},Hzj=function(N){var h,O,u;
return g.c(function(D){if(D.G==1)return N?g.E(D,k2(N,g.Jk,"mainDownloadsListEntity"),2):D.return([]);h=D.W;return((O=h)==null?0:(u=O.downloads)==null?0:u.length)?D.return(h.downloads.map(function(U){var d;return(d=U.videoItem)!=null?d:""})):D.return([])})},WDr=function(N,h){var O;
return g.c(function(u){return u.G==1?g.E(u,TOR(N,h),2):(O=u.W)?g.E(u,Fd(N,{mode:"readwrite",hd:!0},function(D){var U=[Y2(D,O.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];O.mainDownloadsListEntity&&U.push(Y2(D,O.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.w_.all(U)}),0):u.l0(0)})},TOR=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a;
return g.c(function(J){if(J.G==1)return O=g.Fv("main_downloads_library_id","mainDownloadsLibraryEntity"),u=g.Fv("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.E(J,Fd(N,{mode:"readonly",hd:!0},function(W){return g.w_.all([Wu(W,O,"mainDownloadsLibraryEntity"),Wu(W,u,"mainDownloadsListEntity")])}),2);
D=J.W;U=g.I(D);d=U.next().value;b=U.next().value;B=d;C=b;B||(B={id:O});A=g.I(h);for(Q=A.next();!Q.done;Q=A.next())if(L=Q.value,L===g.Jk){if(B.smartDownloadsList)return J.return();B.smartDownloadsList=L}else if(z=g.n$(L).entityType,v={},z==="mainPlaylistEntity"?v.playlistItem=L:z==="mainVideoEntity"&&(v.videoItem=L),!g.ox(v)){t=void 0;if((t=C)==null?0:t.downloads){R=!1;p=g.I(C.downloads);for(M=p.next();!M.done;M=p.next())if(a=M.value,a.playlistItem===L||a.videoItem===L){R=!0;break}R||C.downloads.push(v)}else C=
{id:u,downloads:[v]};B.downloadsList=u}return J.return({mainDownloadsLibraryEntity:B,mainDownloadsListEntity:C})})},X8Y=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R;
return g.c(function(p){if(p.G==1)return O=g.Fv("main_downloads_library_id","mainDownloadsLibraryEntity"),u=g.Fv("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.E(p,Fd(N,{mode:"readonly",hd:!0},function(M){return g.w_.all([Wu(M,O,"mainDownloadsLibraryEntity"),Wu(M,u,"mainDownloadsListEntity"),Wu(M,g.Jk,"mainDownloadsListEntity")])}),2);
D=p.W;U=g.I(D);d=U.next().value;b=U.next().value;B=U.next().value;C=d;A=b;Q=B;if(!C)return p.l0(0);if(h===g.Jk&&((L=Q)==null?0:L.downloads))Q.downloads=[];else if((z=A)==null?0:z.downloads)for(v=g.n$(h).entityType,t=0;t<A.downloads.length;t++)if(R=A.downloads[t],v==="mainVideoEntity"&&R.videoItem===h){A.downloads.splice(t,1);break}else if(v==="mainPlaylistEntity"&&R.playlistItem===h){A.downloads.splice(t,1);break}return g.E(p,Fd(N,{mode:"readwrite",hd:!0},function(M){var a=[Y2(M,C,"mainDownloadsLibraryEntity")];
A&&a.push(Y2(M,A,"mainDownloadsListEntity"));Q&&a.push(Y2(M,Q,"mainDownloadsListEntity"));return g.w_.all(a)}),0)})},RM=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L;
return g.c(function(z){if(z.G==1)return O=g.Fv(h,"transfer"),u=g.Fv(h,"videoDownloadContextEntity"),g.E(z,Fd(N,{mode:"readonly",hd:!0},function(v){return g.w_.all([Wu(v,O,"transfer"),Wu(v,u,"videoDownloadContextEntity")])}),2);
D=z.W;U=g.I(D);d=U.next().value;b=U.next().value;B=d;C=b;L={videoId:h,cotn:(A=B)==null?void 0:A.cotn,offlineModeType:(Q=C)==null?void 0:Q.offlineModeType};return z.return(L)})},Pf=function(N,h,O,u,D){var U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY;
return g.c(function(bY){switch(bY.G){case 1:return U=g.Fv(N,"musicTrack"),d=g.Fv(N,"transfer"),g.E(bY,Fd(h,{mode:"readonly",hd:!0},function(BR){return g.w_.all([Wu(BR,U,"musicTrack"),Wu(BR,d,"transfer"),Xd(BR,"musicTrack"),Xd(BR,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=bY.W;B=g.I(b);C=B.next().value;A=B.next().value;Q=B.next().value;L=B.next().value;z=C;v=A;t=Q;R=L;if(!z){bY.l0(3);break}return g.E(bY,fxV(z,t),4);case 4:return p=bY.W,g.E(bY,ty(p),3);case 3:M=[];a=g.I(R);for(J=a.next();!J.done;J=a.next())W=J.value,F=g.n$(W.key).entityId,l=mL(W),iY=g.n$(l.action.entityKey).entityId,F!==N&&iY!==N||zr(O,W.actionProto)||M.push(W.key);return g.E(bY,Fd(h,{mode:"readwrite",hd:!0},function(BR){var oe=M.map(function(Oa){return lj(BR,Oa)});
oe.push(lj(BR,U,{yX:!0}));return g.w_.all(oe)}),6);
case 6:vf(v),D&&iJ(D),Gr(u,{entityKey:U,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.yy(bY)}})},MW=function(N,h,O,u,D){var U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY,BR,oe,Oa,Ea,nx,or,CS,fx,ae,Gi,sR,XV,bl,e,Ti;
return g.c(function(ar){switch(ar.G){case 1:return U=g.Fv(N,h),d=g.Fv("music_downloads_library_id","musicDownloadsLibraryEntity"),g.E(ar,Fd(O,{mode:"readonly",hd:!0},function(uY){return g.w_.all([Wu(uY,U,h),Wu(uY,d,"musicDownloadsLibraryEntity"),Xd(uY,h),Xd(uY,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=ar.W;B=g.I(b);C=B.next().value;A=B.next().value;Q=B.next().value;L=B.next().value;z=C;v=A;t=Q;R=L;if(!z){ar.l0(3);break}return g.E(ar,fxV(z,t),4);case 4:return p=ar.W,g.E(ar,ty(p),3);case 3:M=[];a=new Map;if(!z){ar.l0(6);break}return g.E(ar,Yh5(z,t,v),7);case 7:M=ar.W;J=g.I(M);for(W=J.next();!W.done;W=J.next())F=W.value,l=g.n$(F).entityId,a.set(l,{videoId:l,playlistId:N,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.E(ar,NW(O,"transfer"),8);case 8:for(iY=ar.W,bY=
g.I(iY),BR=bY.next();!BR.done;BR=bY.next())oe=BR.value,Oa=g.n$(oe.key).entityId,(Ea=a.get(Oa))&&oe&&(Ea.cotn=oe.cotn);case 6:nx=[];or=g.I(R);for(CS=or.next();!CS.done;CS=or.next())fx=CS.value,ae=g.n$(fx.key).entityId,Gi=mL(fx),ae!==N&&Gi.rootActionId!==N||zr(u,fx.actionProto)||nx.push(fx.key);sR=g.Fv(N,h);return g.E(ar,Fd(O,{mode:"readwrite",hd:!0},function(uY){var Rr=nx.map(function(y){return lj(uY,y)});
Rr.push(lj(uY,sR,{yX:!0}));return g.w_.all(Rr)}),9);
case 9:if(!z){ar.l0(0);break}M.reverse();if(!M.length){ar.l0(0);break}XV=g.I(M);bl=XV.next();case 12:if(bl.done){ar.l0(0);break}e=bl.value;Ti=g.n$(e).entityId;if(!Ti){ar.l0(13);break}return g.E(ar,Pf(Ti,O,u,D,a.get(Ti)),13);case 13:bl=XV.next(),ar.l0(12)}})},pf=function(N,h,O){var u,D,U,d,b,B,C;
return g.c(function(A){if(A.G==1)return g.E(A,Fd(N,{mode:"readwrite",hd:!0},function(Q){var L=Xd(Q,"transfer"),z=Xd(Q,"offlineOrchestrationActionWrapperEntity");return g.w_.all([L,z]).then(function(v){v=g.I(v);var t=v.next().value;var R=v.next().value;v=lx4.map(function(J){return E14(Q,J)});
R=g.I(R);for(var p=R.next();!p.done;p=R.next()){p=p.value;var M=g.n$(p.actionProto.entityKey).entityType==="musicTrack",a=p.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";zr(h,p.actionProto)||M&&(!M||a)||v.push(lj(Q,p.key,{yX:!0}))}return g.w_.all(v).then(function(){return t})})}),2);
u=A.W;D=g.I(u);for(U=D.next();!U.done;U=D.next())d=U.value,vf(d),b=g.n$(d.key).entityId,B={videoId:b,offlineDeleteReason:void 0,cotn:d.cotn},iJ(B),C=g.Fv(b,"musicTrack"),Gr(O,{entityKey:C,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.E(A,ELV(),0)})},xmY=function(N){for(var h,O=g.I(N.additionalMetadatas),u=O.next();!u.done;u=O.next())u=u.value,u.offlineMusicVideoData&&(h=u.offlineMusicVideoData);
var D,U,d,b,B;return{id:g.Fv(N.videoId,"musicTrack"),videoId:N.videoId,title:N.title,thumbnailDetails:N.thumbnail,lengthMs:String(Number(N.lengthSeconds)*1E3),albumTitle:(D=h)==null?void 0:D.releaseTitle,musicVideoType:(U=h)==null?void 0:U.musicVideoType,contentRating:{explicitType:(d=h)==null?void 0:d.explicitType},artistNames:((b=h)==null?void 0:b.byline)||((B=h)==null?void 0:B.channelName),downloadMetadata:g.Fv(N.videoId,"musicTrackDownloadMetadataEntity")}},Yh5=function(N,h,O){var u,D,U,d,b,B,
C,A,Q,L,z,v,t,R,p,M,a,J;
return g.c(function(W){u=[];D=new Set;if((U=O)==null?0:(d=U.downloadedTracks)==null?0:d.length)for(b=g.I(O.downloadedTracks),B=b.next();!B.done;B=b.next())C=B.value,D.add(C);if(N.tracks){A=g.I(N.tracks);for(Q=A.next();!Q.done;Q=A.next())L=Q.value,D.has(L)||u.push(L);z=g.I(h);for(v=z.next();!v.done;v=z.next())if(t=v.value,t.id!==N.id&&(R=t.tracks))for(p=g.I(R),M=p.next();!M.done;M=p.next())a=M.value,J=u.indexOf(a),J!==-1&&u.splice(J,1)}return W.return(u)})},fxV=function(N,h){var O,u,D,U,d,b,B,C;
return g.c(function(A){O=wL(N.thumbnailDetails);u=g.I(h);for(D=u.next();!D.done;D=u.next())if(U=D.value,U.id!==N.id)for(d=g.I(wL(U.thumbnailDetails)),b=d.next();!b.done;b=d.next())B=b.value,C=O.indexOf(B),C!==-1&&O.splice(C,1);return A.return(O)})},nLj=function(N,h){var O,u,D,U,d,b,B,C,A;
return g.c(function(Q){if(Q.G==1)return O=g.Fv("music_downloads_library_id","musicDownloadsLibraryEntity"),g.E(Q,k2(N,O,"musicDownloadsLibraryEntity"),2);(u=Q.W)||(u={id:O});D=g.n$(h).entityType;D==="musicTrack"?(U=u.downloadedTracks)!=null&&U.includes(h)||(u.downloadedTracks=((d=u.downloadedTracks)!=null?d:[]).concat(h)):D==="musicPlaylist"?(b=u.downloadedPlaylists)!=null&&b.includes(h)||(u.downloadedPlaylists=((B=u.downloadedPlaylists)!=null?B:[]).concat(h)):D!=="musicAlbumRelease"||(C=u.downloadedAlbumReleases)!=
null&&C.includes(h)||(u.downloadedAlbumReleases=((A=u.downloadedAlbumReleases)!=null?A:[]).concat(h));return g.E(Q,Z5(N,u,"musicDownloadsLibraryEntity"),0)})},FD5=function(N,h){var O,u,D,U,d,b,B;
return g.c(function(C){if(C.G==1)return O=g.Fv("music_downloads_library_id","musicDownloadsLibraryEntity"),g.E(C,k2(N,O,"musicDownloadsLibraryEntity"),2);u=C.W;if(!u)return C.l0(0);D=g.n$(h).entityType;D==="musicTrack"?U=u.downloadedTracks:D==="musicPlaylist"&&(U=u.downloadedPlaylists);if((d=U)==null?0:d.length)for(b=0;b<U.length;b++)if(B=U[b],B===h){U.splice(b,1);break}return g.E(C,Z5(N,u,"musicDownloadsLibraryEntity"),0)})},Zz5=function(N){var h=N.videos;
N=[];var O=[];if(h){h=g.I(h);for(var u=h.next();!u.done;u=h.next()){var D=u.value.offlineVideoData.videoId;u=g.Fv(D,"musicTrack");D=g.Fv(D,"musicTrackDownloadMetadataEntity");N.push(u);O.push(D)}}return{XD:N,ID:O}},eF=function(N,h,O){h={track:xmY(h)};
O&&(h.playlistId=O);if(N=g.X(N.actionMetadata,kxV))h.maximumDownloadQuality=N.maximumDownloadQuality;return{musicTrackEntityActionMetadata:h}},hGR=function(N){var h,O,u,D,U,d,b,B;
return g.c(function(C){switch(C.G){case 1:return h=g.fW(),O=kjm(N),u=g.Z$(NI4),g.Vy(C,2),U={L5:!0},g.E(C,g.q_(h,O,u,void 0,U),4);case 4:D=C.W;g.Mt(C,3);break;case 2:d=g.eo(C);if(d instanceof g.TT)throw b="GetOffline network manager error: "+d.message,U6(b,d),Error(b);U6("GetOffline fetch request error",d);throw Error("GetOffline fetch request error");case 3:B=E6(D);if(!D)throw U6("Network request failed"),Error("Network request failed");if(B!==void 0)cf(B);else if(!D.videos||!D.videos.length)throw U6("No data"),
Error("No data");return C.return(D.videos.map(function(A){return A.offlineVideoData}))}})},OdK=function(N){var h,O,u,D,U,d,b,B;
return g.c(function(C){switch(C.G){case 1:return h=g.fW(),O=NOY(N),u=g.Z$(NI4),g.Vy(C,2),U={L5:!0},g.E(C,g.q_(h,O,u,void 0,U),4);case 4:D=C.W;g.Mt(C,3);break;case 2:d=g.eo(C);if(d instanceof g.TT)throw b="GetOffline network manager error for playlist: "+d.message,U6(b,d),Error(b);U6("GetOffline fetch request error for playlist",d);throw Error("GetOffline fetch request error for playlist");case 3:B=E6(D);if(!D)throw U6("Network request failed for playlist"),Error("Network request failed for playlist");
if(B!==void 0)cf(B,"playlist");else if(!D.playlists||!D.playlists.length)throw U6("No data for playlist"),Error("No data for playlist");return C.return(D.playlists.map(function(A){return A.offlinePlaylistData}))}})},DxY=function(N,h,O,u){var D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY,BR,oe,Oa,Ea,nx,or,CS,fx;
return g.c(function(ae){switch(ae.G){case 1:return g.E(ae,hy(),2);case 2:D=ae.W;if(!D)return ae.return([]);U=[];if((d=u)==null?0:d.length){U=u;ae.l0(3);break}return g.E(ae,NW(D,"mainPlaylistEntity"),4);case 4:U=ae.W;case 3:if(!U.length)return ae.return([]);b=[];B=Date.now()/1E3;C=g.I(U);A=C.next();case 5:if(A.done)return b.length?g.E(ae,ukV(b),10):ae.return([]);Q=A.value;if(!Q.downloadState){L=void 0;ae.l0(8);break}return g.E(ae,k2(D,Q.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:L=
ae.W;case 8:z=L;v=void 0;R=(t=(v=Q)==null?void 0:v.entityMetadata)&&t.nextAutoRefreshIntervalSeconds?Number(t.nextAutoRefreshIntervalSeconds):NaN;p=Number.isNaN(R)?N:R;a=M=void 0;J=((M=z)==null?0:M.lastSyncedTimestampMillis)?Number((a=z)==null?void 0:a.lastSyncedTimestampMillis)/1E3:0;F=W=void 0;l=((W=z)==null?0:W.addedTimestampMillis)?Number((F=z)==null?void 0:F.addedTimestampMillis)/1E3:0;if(O||!t||J+p<=B){iY=[];bY=void 0;if((bY=Q.videos)==null?0:bY.length)for(BR=g.I(Q.videos),oe=BR.next();!oe.done;oe=
BR.next())Oa=oe.value,Ea=JSON.parse(g.n$(Oa).entityId),Ea.videoId&&iY.push(Ea.videoId);nx="0";t&&(or=void 0,nx=String(Number((or=t.offlineLastModifiedTimestampSeconds)!=null?or:0).toFixed()));CS={playlistId:Q.playlistId,videoIds:iY,offlineLastModifiedTimestamp:nx,autoSync:h,offlineDateAddedTimestamp:String(l.toFixed())};b.push(CS)}A=C.next();ae.l0(5);break;case 10:return fx=ae.W,ae.return(fx)}})},Ux4=function(){var N,h,O,u,D;
return g.c(function(U){if(U.G==1)return g.E(U,hy(),2);if(U.G!=3)return(N=U.W)?g.E(U,NW(N,"refresh"),3):U.return(!1);h=U.W;if((O=h[0])==null||!O.refreshTime)return U.return(!1);u=Number(h[0].refreshTime);D=Date.now()/1E3;return U.return(isFinite(u)&&D>=u)})},GCY=function(N,h){var O,u,D;
return g.c(function(U){switch(U.G){case 1:return g.Vy(U,2),g.E(U,dx5(N,h),4);case 4:return u=U.W,g.E(U,J0r(u),5);case 5:O=Shx(u);g.Mt(U,3);break;case 2:D=g.eo(U),U6("getAndProcessSmartDownloadsResponse request or processing error",D);case 3:return U.return(O)}})},bd4=function(N,h,O,u){var D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY,BR,oe,Oa,Ea,nx,or,CS,fx;
return g.c(function(ae){switch(ae.G){case 1:return g.E(ae,hy(),2);case 2:D=ae.W;if(!D)return ae.return([]);U=[];if((d=u)==null?0:d.length){U=u;ae.l0(3);break}return g.E(ae,NW(D,"musicPlaylist"),4);case 4:U=ae.W;case 3:if(!U.length)return ae.return([]);b=[];B=Date.now()/1E3;C=g.I(U);A=C.next();case 5:if(A.done)return b.length?g.E(ae,ukV(b),10):ae.return([]);Q=A.value;L=void 0;v=(z=(L=Q)==null?void 0:L.entityMetadata)&&z.nextAutoRefreshIntervalSeconds?Number(z.nextAutoRefreshIntervalSeconds):NaN;t=
Number.isNaN(v)?N:v;p=R=0;M="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!Q.downloadMetadata){ae.l0(8);break}return g.E(ae,k2(D,Q.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:a=ae.W,W=J=void 0,R=Number((W=(J=a)==null?void 0:J.addedTimestampMillis)!=null?W:"0")/1E3,l=F=void 0,p=Number((l=(F=a)==null?void 0:F.lastModifiedTimestampMillis)!=null?l:"0")/1E3,bY=iY=void 0,M=(bY=(iY=a)==null?void 0:iY.syncState)!=null?bY:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:BR=void 0;if(O||M!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!z||Number((BR=z.lastSyncedTimestampSeconds)!=null?BR:0)+t<=B){oe=[];Oa=void 0;if((Oa=Q.tracks)==null?0:Oa.length)for(Ea=g.I(Q.tracks),nx=Ea.next();!nx.done;nx=Ea.next())or=nx.value,oe.push(g.n$(or).entityId);CS={playlistId:Q.playlistId,videoIds:oe,offlineLastModifiedTimestamp:String(p.toFixed()),autoSync:h,offlineDateAddedTimestamp:String(R.toFixed())};b.push(CS)}A=C.next();ae.l0(5);break;case 10:return fx=ae.W,ae.return(fx)}})},dx5=function(N,h){var O,u,D,U,d,b,B,C,A,Q;
return g.c(function(L){switch(L.G){case 1:return O=g.fW(),g.E(L,hy(),2);case 2:u=L.W;if(!u){L.l0(3);break}return g.E(L,GxS(u),4);case 4:D=L.W;case 3:var z=D;U={context:g.x5(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:N},offlineClientState:z,clientStateRequestData:{preferredFormatType:h}}}};d=g.Z$(idS);g.Vy(L,5);B={L5:!0};return g.E(L,g.q_(O,U,d,void 0,B),7);case 7:b=L.W;g.Mt(L,6);break;case 5:C=g.eo(L);if(C instanceof g.TT)throw A=
"DPS network manager error for smart downloads: "+C.message,U6(A,C),Error(A);U6("DPS fetch request error for smart downloads",C);throw Error("DPS fetch request error for smart downloads");case 6:Q=E6(b);if(b)Q!==void 0&&cf(Q,"smart downloads");else throw U6("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return L.return(b)}})},C9S=function(N,h){var O,u,D,U,d,b,B,C;
return g.c(function(A){switch(A.G){case 1:return O=g.fW(),u={context:g.x5(),videoPlaybackPositionEntities:N,lastSyncTimestampUsec:h},D=g.Z$(BI4),g.Vy(A,2),d={L5:!0},g.E(A,g.q_(O,u,D,void 0,d),4);case 4:U=A.W;g.Mt(A,3);break;case 2:b=g.eo(A);if(b instanceof g.TT)throw B="VPPS network manager error: "+b.message,U6(B,b),Error(B);U6("VPPS fetch request error",b);throw Error("VPPS fetch request error");case 3:C=E6(U);if(U)C!==void 0&&cf(C,"position sync");else throw U6("Network request failed for position sync"),
Error("Network request failed for position sync");return A.return(U)}})},oiS=function(N,h,O){var u,D,U,d,b,B,C,A;
return g.c(function(Q){switch(Q.G){case 1:u=g.fW();var L=O.refreshData,z=O.isEnqueuedForExpiredStreamUrlRefetch,v=O.nO,t=O.offlineSourceData,R=O.mediaCapabilities,p={entityKey:N};L&&(p.refreshData=L);z&&(p.isExpiredStreamUrlRefetch=z);v&&(p.downloadParameters=v);t&&(p.offlineSourceData=t);L={context:g.Pc(h),signatureTimestamp:20321,videos:[p]};R&&(L.mediaCapabilities=R);D=L;U=g.Z$(Ah4);g.Vy(Q,2);b={L5:!0};return g.E(Q,g.q_(u,D,U,void 0,b),4);case 4:d=Q.W;g.Mt(Q,3);break;case 2:B=g.eo(Q);if(B instanceof
g.TT)throw C="GetPDE network manager error: "+B.message,U6(C,B),Error(C);U6("GetPDE fetch request error",B);throw Error("GetPDE fetch request error");case 3:A=E6(d);if(d)A!==void 0&&cf(A,"PDE");else throw U6("Network request failed for PDE"),Error("Network request failed for PDE");return Q.return(d)}})},E6=function(N){var h;
return(h=N.errorMetadata)==null?void 0:h.status},cf=function(N,h){h=h?" for "+h:"";
if(N===0)throw N="Empty response body"+h,U6(N),Error(N);N="Response with error"+h;U6(N);throw Error(N);},ukV=function(N){var h,O,u,D,U,d,b,B;
return g.c(function(C){switch(C.G){case 1:return h=g.fW(),O=hvn(N),u=g.Z$(QJR),g.Vy(C,2),U={L5:!0},g.E(C,g.q_(h,O,u,void 0,U),4);case 4:D=C.W;g.Mt(C,3);break;case 2:d=g.eo(C);if(d instanceof g.TT)throw b="offlinePlaylistSyncCheck network manager error: "+d.message,U6(b,d),Error(b);U6("offlinePlaylistSyncCheck fetch request error",d);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:B=E6(D);if(!D)throw U6("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(B!==void 0)cf(B,"playlist sync");else if(!D.offlinePlaylistSyncCheckDatas||!D.offlinePlaylistSyncCheckDatas.length)throw U6("No data for playlist sync"),Error("No data for playlist sync");return C.return(D.offlinePlaylistSyncCheckDatas.map(function(A){return A.offlinePlaylistSyncCheckData}))}})},aM=function(N){this.G=N},LKx=function(N,h){var O,u,D,U,d,b;
return g.c(function(B){switch(B.G){case 1:O=new Map,u=g.I(h),D=u.next();case 2:if(D.done){B.l0(4);break}U=D.value;d=O;b=d.set;return g.E(B,N.W(U),5);case 5:b.call(d,U,B.W);D=u.next();B.l0(2);break;case 4:return B.return(O)}})},qW=function(N,h,O,u,D,U){h=g.Fv(h,O);
u=Object.assign({},U,{priority:u,retryScheduleIntervalsInSeconds:D});return{actionType:N,entityKey:h,actionMetadata:u}},gL=function(N,h,O,u,D,U){this.status=N;
this.G=h;this.X=O;this.W=u;this.U=D;this.downloadState=U},zGo=function(N,h,O){this.G=N;
this.Qm=h;this.U=O},KKS=function(N,h){var O,u,D,U,d,b,B,C,A;
return g.c(function(Q){switch(Q.G){case 1:return O=h.entityKey,D=(u=g.X(h.actionMetadata,rL))==null?void 0:u.isEnqueuedForExpiredStreamUrlRefetch,g.Vy(Q,2),U=void 0,g.E(Q,vin(N,h),4);case 4:U=Q.W;g.Vy(Q,5);var L=(L=g.X(h.actionMetadata,rL))?{maximumDownloadQuality:L.maximumDownloadQuality}:void 0;return g.E(Q,oiS(O,N.Qm,{isEnqueuedForExpiredStreamUrlRefetch:D,nO:L,offlineSourceData:U}),7);case 7:d=Q.W;g.Mt(Q,6,2);break;case 5:return g.eo(Q,2),b=Cf(h)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",U6("PDE handleAdd error"),Q.return(s6(h,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",b,"DOWNLOAD_STATE_FAILED"));case 6:return g.E(Q,wD5(N,d,h),8);case 8:return Q.return(s6(h,!0,d.orchestrationActions));case 2:return B=g.eo(Q),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.CV&&B.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
A="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),U6("PDE handleAdd error"),Q.return(s6(h,!1,void 0,C,A,"DOWNLOAD_STATE_FAILED"))}})},tp5=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY;
return g.c(function(BR){switch(BR.G){case 1:return O=h.entityKey,u=g.n$(O).entityId,g.E(BR,Fd(N.G,{mode:"readonly",hd:!0},function(oe){var Oa=Wu(oe,O,"playbackData"),Ea=Wu(oe,g.Fv(u,"offlineVideoPolicy"),"offlineVideoPolicy");oe=Wu(oe,g.Fv(u,"transfer"),"transfer");return g.w_.all([Oa,Ea,oe])}),2);
case 2:D=BR.W;U=g.I(D);d=U.next().value;b=U.next().value;B=U.next().value;C=d;A=b;Q=B;if(!C||!A)return BR.return(s6(h,!0));L=[];t=((v=C)==null?0:v.playerResponseJson)?JSON.parse(C.playerResponseJson):null;if(!(Q&&t&&N.Qm.j("html5_refresh_deprecated_downloads"))){BR.l0(3);break}z=mx4(N,t,Q);return g.E(BR,IGR(N,Q),4);case 4:L=BR.W;case 3:R={lastPlayerResponseTimestampSeconds:C.playerResponseTimestamp,offlineToken:A.offlineToken,formatIds:L};p={};if((M=Q)==null?0:M.maximumDownloadQuality)p.maximumDownloadQuality=
Q.maximumDownloadQuality;g.Vy(BR,5);a=void 0;return g.E(BR,vin(N,h),7);case 7:return a=BR.W,g.Vy(BR,8),g.E(BR,oiS(O,N.Qm,{refreshData:R,nO:p,offlineSourceData:a,mediaCapabilities:z}),10);case 10:J=BR.W;g.Mt(BR,9,5);break;case 8:return g.eo(BR,5),W=Cf(h)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",U6("PDE handleRefresh error"),BR.return(s6(h,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",W,
"DOWNLOAD_STATE_FAILED"));case 9:return g.E(BR,wD5(N,J,h),11);case 11:return BR.return(s6(h,!0,J.orchestrationActions));case 5:return F=g.eo(BR),l="PDE handleRefresh error",F instanceof Error&&(l="PDE handleRefresh error: "+F.message),iY="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",bY="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.CV&&F.type==="QUOTA_EXCEEDED"&&(iY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",bY="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
U6(l),BR.return(s6(h,!1,void 0,iY,bY,"DOWNLOAD_STATE_FAILED"))}})},vin=function(N,h){var O,u,D,U;
return g.c(function(d){if(d.G==1)return O=g.n$(h.entityKey).entityId,u=g.Fv(O,"videoDownloadContextEntity"),g.E(d,k2(N.G,u,"videoDownloadContextEntity"),2);D=d.W;return(U=D)!=null&&U.offlineModeType?d.return({offlineModeType:D.offlineModeType}):d.return(void 0)})},wD5=function(N,h,O){var u,D,U,d,b;
return g.c(function(B){if(B.G==1){if(!h.frameworkUpdates||!g.X(h.frameworkUpdates,Vw))return B.return();if(!(g.X(h.frameworkUpdates,Vw).mutations&&g.X(h.frameworkUpdates,Vw).mutations.length>0&&g.X(h.frameworkUpdates,Vw).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return B.l0(2);u=g.n$(g.X(h.frameworkUpdates,Vw).mutations[0].entityKey).entityId;return g.E(B,RM(N.G,u),3)}if(B.G!=2){D=B.W;U=g.X(O.actionMetadata,rL);if(b=(d=U)==null?void 0:d.playlistId)D.playlistId=b;D.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.yv(N.Qm)?g.E(B,yw(u,N.G,O,N.U,D),2):g.qG(N.Qm)?g.E(B,Pf(u,N.G,O,N.U),2):B.l0(2)}return g.E(B,Xvm(g.X(h.frameworkUpdates,Vw)),0)})},s6=function(N,h,O,u,D,U){return new gL(h?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Cf(N),O,u,D,U)},mx4=function(N,h,O){h=p8R(N.Qm,O.cotn,h);
O=g.gZ(h);return g.ESy(h,O,N.Qm)},IGR=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L;
return g.c(function(z){if(z.G==1)return O=[],g.E(z,Fd(N.G,{mode:"readonly",hd:!0},function(v){var t=[],R=h.offlineVideoStreams;if(R){R=g.I(R);for(var p=R.next();!p.done;p=R.next())t.push(Wu(v,p.value,"offlineVideoStreams"))}return g.w_.all(t)}),2);
if(u=z.W)for(D=g.I(u),U=D.next();!U.done;U=D.next())if(d=U.value,b=void 0,(b=d)==null?0:b.streamsProgress)for(B=d.streamsProgress,C=0;C<B.length;C++)A=B[C],Q=JSON.parse(A.formatStreamBytes),L={itag:Q.itag,lmt:Q.lastModified,xtags:Q.xtags},O.push(L);return z.return(O)})},$xV=function(N,h){this.G=N;
this.Qm=h},yhj=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z;
return g.c(function(v){switch(v.G){case 1:return O=Cf(h),g.E(v,NW(N.G,"videoPlaybackPositionEntity"),2);case 2:u=v.W;if(u.length===0)return v.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.Vy(v,3);return g.E(v,Su.getInstance(),5);case 5:D=v.W;if(!D)throw Error("prefStorage is undefined");return g.E(v,D.get("psi"),6);case 6:return U=v.W,B=(b=(d=U)==null?void 0:d.Qn)!=null?b:"0",g.E(v,C9S(u,B),7);case 7:return C=v.W,A={isPaused:C.watchHistoryPaused,Qn:C.syncTimestampUsec},g.E(v,D.set("psi",
A),8);case 8:if(A.isPaused){v.l0(9);break}Q=g.X(C.frameworkUpdates,Vw);if(!C.frameworkUpdates||!Q){v.l0(9);break}return g.E(v,Xvm(Q),9);case 9:g.Mt(v,4);break;case 3:return L=g.eo(v),z="PPE handleRefresh error: "+(L instanceof Error?L.message:"unknown error"),U6(z),v.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return v.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},RGx=function(N,h){var O,u,D,U,d,b,B,C;
return g.c(function(A){switch(A.G){case 1:return O=Cf(h),u=g.n$(h.entityKey).entityId,g.Vy(A,2),g.E(A,Su.getInstance(),4);case 4:D=A.W;if(!D)throw Error("prefStorage is undefined");return g.E(A,D.get("psi"),5);case 5:U=A.W;d=g.X(h.actionMetadata,Vpr);if(((b=U)==null?void 0:b.isPaused)!==!1||(B=d)==null||!B.lastPlaybackPositionSeconds){A.l0(6);break}C={key:g.Fv(u,"videoPlaybackPositionEntity"),videoId:u,lastPlaybackPositionSeconds:d.lastPlaybackPositionSeconds};return g.E(A,Z5(N.G,C,"videoPlaybackPositionEntity"),
6);case 6:g.Mt(A,3);break;case 2:return g.eo(A),A.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},P9x=function(N,h){var O,u,D;
return g.c(function(U){switch(U.G){case 1:O=Cf(h);g.Vy(U,2);u=g.n$(h.entityKey).entityId;if(u==="!*$_ALL_ENTITIES_!*$")return g.E(U,jGo(N.G),5);D=g.Fv(u,"videoPlaybackPositionEntity");return g.E(U,Jzr(N.G,D),5);case 5:g.Mt(U,3);break;case 2:return g.eo(U),U.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},Mpr=function(N,h){this.api=N;
this.G=h;this.logger=new g.tL("woffle");this.W=!1;this.KF={Sa:this.Sa};this.logger.debug("Initialized OfflineMediaManager")},pD4=function(N){return g.c(function(h){return h.return(ZmV(N))})},eGS=function(N){var h;
return g.c(function(O){if(O.G==1)return g.E(O,g.Fzo(N),2);h=O.W;return O.return(h.filter(function(u){return!!u.url}).map(function(u){return u.url}))})},Jy=function(N,h){var O=g.Uw(h);
if(O===1||O===0)return Promise.resolve();(O=Eio(N,h))&&O.stopVideo();N.U=0;return pD4(h)},jF=function(N,h,O,u){O=O===void 0?!1:O;
u=u===void 0?!0:u;var D=typeof h==="string"?h:h.videoDetails.videoId;g.Uw(D)===2&&((h=Eio(N,D))?h.stopVideo():N.logger.info(function(){return"Corresponding player for "+D+" not found. Pausing anyway"}),g.dZ(D,2),N.U=2,O?chj(N.G):u&&aGK(N.G))},Eio=function(N,h){var O;
return((O=N.player)==null?void 0:O.getVideoData().videoId)===h?N.player:null},qCn=function(N,h,O){h.getPlayerResponse();
g.dZ(h.videoId,2);N.U=2;N.W=!1;var u;(u=N.player)==null||u.dispose();N.player=N.api.Yg(h);h={};N.player.Cc((h.localmediachange=N.rD,h.signatureexpired=N.KY,h.statechange=N.OFr,h),N);N.j("html5_generate_content_po_token")&&N.player.H0();var D=N.Sa(O);N.player.Sl(g.MU(D,D,!0,"m"),!1);N.logger.debug(function(){return"Starting headless playback with quality: "+D});
N.player.Nu(!1)},giS=function(N,h){this.G=N;
this.Qm=h},sJV=function(N,h){var O,u;
return g.c(function(D){switch(D.G){case 1:return O=Cf(h),g.E(D,k2(N.G,h.entityKey,"transfer"),2);case 2:if(u=D.W)return D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.Vy(D,3);return g.E(D,rhm(N,h),5);case 5:g.Mt(D,4);break;case 3:return g.eo(D),D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},Jhn=function(N,h){var O,u;
return g.c(function(D){switch(D.G){case 1:return O=Cf(h),g.E(D,k2(N.G,h.entityKey,"transfer"),2);case 2:u=D.W;if(!u||u.transferState!=="TRANSFER_STATE_COMPLETE")return D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.Vy(D,3);return g.E(D,rhm(N,h,!0),5);case 5:g.Mt(D,4);break;case 3:return g.eo(D),D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},jJo=function(N,h){var O,u,D,U,d,b,B,C,A,Q;
return g.c(function(L){switch(L.G){case 1:return O=Cf(h),u=g.n$(h.entityKey).entityId,g.E(L,Fd(N.G,{mode:"readonly",hd:!0},function(z){var v=Wu(z,h.entityKey,"transfer");z=Wu(z,g.Fv(u,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w_.all([v,z])}),2);
case 2:D=L.W;U=g.I(D);d=U.next().value;b=U.next().value;B=d;C=b;if(!B||B.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return L.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.Vy(L,3);B.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.E(L,Z5(N.G,B,"transfer"),5);case 5:A=g.n$(B.key).entityId;$mK({videoId:A,w9:B,offlineModeType:(Q=C)==null?void 0:Q.offlineModeType});g.Mt(L,4);break;case 3:return g.eo(L),L.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return L.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},rhm=function(N,h,O){O=O===void 0?!1:O;
var u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p;return g.c(function(M){switch(M.G){case 1:return u=g.X(h.actionMetadata,SCx),D=g.n$(h.entityKey).entityId,U=g.Fv(D,"downloadStatusEntity"),g.E(M,Fd(N.G,{mode:"readonly",hd:!0},function(a){var J=Wu(a,U,"downloadStatusEntity");a=Wu(a,g.Fv(D,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w_.all([J,a])}),2);
case 2:return d=M.W,b=g.I(d),B=b.next().value,C=b.next().value,A=B,Q=C,L="TRANSFER_STATE_TRANSFER_IN_QUEUE",((z=A)==null?void 0:z.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(L="TRANSFER_STATE_PAUSED_BY_USER"),R={key:h.entityKey,transferState:L,cotn:g.vJ(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(v=u)==null?void 0:v.maximumDownloadQuality,preferredAudioTrack:(t=u)==null?void 0:t.preferredAudioTrack,transferRetryCount:0,isRefresh:O,hasLoggedFirstStarted:!1},g.E(M,Fd(N.G,
{mode:"readwrite",hd:!0},function(a){var J=[];O&&J.push(lj(a,g.Fv(D,"offlineVideoStreams")));J.push(Y2(a,R,"transfer"));return g.w_.all(J)}),3);
case 3:if(!O){M.l0(4);break}return g.E(M,pD4(D),4);case 4:IxY({videoId:D,w9:R,offlineModeType:(p=Q)==null?void 0:p.offlineModeType}),g.yy(M)}})},TIV=function(N,h,O,u){if(!N.action.entityKey)throw Error("entityKey is missing.");
var D=g.n$(N.action.entityKey);D={entityType:D.Pm,entityId:D.entityId,offlineOrchestrationActionType:N.action.actionType,orchestrationAction:{orchestrationActionId:N.actionId}};h&&(D.offlineOrchestrationActionResult=h.status,D.isRetryable=O?!1:h.G,h.U&&(D.offlineOrchestrationFailureReason=HdS(h.U,D.isRetryable)));var U,d;if((U=N.action.actionMetadata)==null?0:(d=U.offlineLoggingData)==null?0:d.offlineModeType)D.offlineModeType=N.action.actionMetadata.offlineLoggingData.offlineModeType;u&&(D.additionalOrchestrationActions=
u.map(function(b){return{orchestrationActionId:b.actionId}}));
return D},HdS=function(N,h){return N!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||h?N==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&h?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":N:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},WKR=function(N,h){var O={offlineOrchestrationContext:TIV(N)};
h=UmS(h,O);dmV(Dmr(),h,N.rootActionId)},XD5=function(N,h,O,u){u=u===void 0?[]:u;
h={offlineOrchestrationContext:TIV(N,h,O,u)};h=UmS(3,h);dmV(Dmr(),h,N.rootActionId)},fGY=function(){this.actions=[]},YCR=function(N,h){h=g.I(h);
for(var O=h.next();!O.done;O=h.next())O=O.value,WKR(O,1),N.actions.push(O);N.actions.sort(N.G)},lGR=function(N,h){if(h)for(var O=0;O<N.actions.length;O++)if(h==="!*$_ALL_ENTITIES_!*$"&&N.actions[O].actionId!==h||h!=="!*$_ALL_ENTITIES_!*$"&&N.actions[O].rootActionId===h&&N.actions[O].actionId!==h)N.actions.splice(O,1),O--},xx4=function(N,h){N=g.I(N.actions);
for(var O=N.next();!O.done;O=N.next())if(O.value.actionId===h)return!0;return!1},SF=function(N,h,O,u,D){g.S.call(this);
var U=this;this.W=N;this.vB=h;this.eS=O;this.B=u;this.Qm=D;this.G=new fGY;this.V=new g.HT;this.U=new g.YL(function(){U.retry()});
this.Y=NaN;this.L=!1;this.KF={WIi:function(){return U.G},
rR:function(){return U.V},
X$n:function(){return U.U},
retry:function(){return U.retry()}};
g.H(this,this.U);this.D=this.W.observe(this.fC.bind(this))},Zdn=function(N,h,O,u,D){var U;
return g.c(function(d){if(d.G==1)return U=new SF(N,h,O,u,D),g.E(d,niS(U),2);FKr(U);return d.return(U)})},FKr=function(N){var h=N.G.actions[0];
return N.X?((h==null?void 0:h.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&N.X[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(N.L=!0),Promise.resolve()):kCS(N)},kCS=function(N){var h,O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p;
return g.c(function(M){switch(M.G){case 1:if(N.X)throw Error("Already processing an action");if(N.SS())return M.return();h=N.G.actions.shift();KDK(N.eS,!h);if(h===void 0)return M.return();h.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&h.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&lGR(N.G,h.actionId);O="";h.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&h.rootActionId===h.actionId&&(O=h.actionId);u=[h];N.X=u;if(D=N.vB[h.entityType]){M.l0(2);break}N.X=
void 0;return g.E(M,kCS(N),3);case 3:return M.return();case 2:U=g.I(u);for(d=U.next();!d.done;d=U.next())b=d.value,WKR(b,2);g.Vy(M,4,5);return g.E(M,LKx(D,u.map(function(a){return a.action})),7);
case 7:B=M.W,C=g.I(u),A=C.next();case 8:if(A.done){M.l0(10);break}Q=A.value;L=B.get(Q.action);return g.E(M,Nfj(N,Q,L),9);case 9:A=C.next();M.l0(8);break;case 10:lGR(N.G,O);case 5:g.qt(M);N.X=void 0;g.go(M,6);break;case 4:return z=g.eo(M),U6("Orchestration error",z),g.Vy(M,12),g.E(M,hdK(N,u),14);case 14:g.Mt(M,5);break;case 12:v=g.eo(M);U6("Orchestration retry error",v);t=g.I(u);for(R=t.next();!R.done;R=t.next())p=R.value,p.retryScheduleIndex<3&&YCR(N.G,[p]);M.l0(5);break;case 6:return g.E(M,kCS(N),
0)}})},Nfj=function(N,h,O){var u,D,U,d,b,B,C,A,Q,L,z,v;
return g.c(function(t){switch(t.G){case 1:u=h.retryScheduleIndex+2===3;if(O.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){t.l0(2);break}if(O.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){t.l0(0);break}XD5(h,O,u);if(O.G&&h.retryScheduleIndex+1<3)return g.E(t,hdK(N,[h]),0);U=((D=O)==null?0:D.W)?O.W:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";d={entityKey:h.action.entityKey,failureReason:U};b=void 0;g.yv(N.Qm)?b="mainVideoDownloadStateEntity":g.qG(N.Qm)&&(b="musicTrackDownloadMetadataEntity");
if(!b||!O.downloadState){t.l0(7);break}B=g.n$(h.action.entityKey).entityId;return g.E(t,Lf(B,b,N.W,O.downloadState),7);case 7:Gr(N.B,d);if(O.downloadState==="DOWNLOAD_STATE_FAILED"&&N.Qm.j("html5_auto_retry_failed_pde_actions")){t.l0(0);break}U6("Orchestration result is not retryable, deleting action");return g.E(t,Jzr(N.W,IM(h).key),0);case 2:C=void 0;try{C=(A=O.X)==null?void 0:A.map(function(R){return N.createAction(R,h)})}catch(R){return XD5(h,O,u),Q={entityKey:h.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Gr(N.B,Q),U6("Orchestration subactions creation error",R),t.return()}XD5(h,O,u,C);if(!C){t.l0(12);break}L=C.map(function(R){return IM(R)});
z=0;case 13:if(!(z<C.length)||N.L){t.l0(15);break}return g.E(t,Fd(N.W,{mode:"readwrite",hd:!0},function(R){var p=[];p.push(MWR(R,L.slice(z,z+10),"offlineOrchestrationActionWrapperEntity"));return g.w_.all(p)}),16);
case 16:z+=10;t.l0(13);break;case 15:if(N.L)return N.L=!1,t.return();case 12:return v=IM(h),g.E(t,Jzr(N.W,v.key),17);case 17:WKR(h,4),g.yy(t)}})},U3S=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z;
return g.c(function(v){O=[];u=Infinity;D=4E3;U=g.I(h);for(d=U.next();!d.done;d=U.next())b=d.value,B=Number(b.enqueueTimeSec),C=O7K(B),A=b.retryScheduleIndex,Q=A!=null&&A>0,C>0&&Q?(u=Math.min(u,B),D=Math.min(C,D)):O.push(b);isFinite(u)&&(!N.U.isActive()||u<N.Y)&&(N.Y=u,N.U.start(D));N.V.rA()||(L=O.length,O=O.filter(function(t){var R;t=((R=t.actionProto)==null?void 0:R.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!u45.includes(t)}),z=O.length<L,!N.U.isActive()&&z&&N.U.start(1));
O.length>0&&D3K(N,O);return g.E(v,FKr(N),0)})},Gbj=function(N){var h,O,u,D,U,d,b;
return g.c(function(B){if(B.G==1)return g.E(B,d34(N),2);h=B.W;O=[];u=g.I(h);for(D=u.next();!D.done;D=u.next())U=D.value,d=g.n$(U.key),b=d.entityId,xx4(N.G,b)||O.push(U);return g.E(B,U3S(N,O),0)})},O7K=function(N){N=N*1E3-Date.now();
return N>4E3?4E3:N},hdK=function(N,h){var O,u,D;
return g.c(function(U){O=g.I(h);for(u=O.next();!u.done;u=O.next()){D=u.value;var d=void 0,b=void 0,B=((b=D.action)==null?void 0:(d=b.actionMetadata)==null?void 0:d.retryScheduleIntervalsInSeconds)||[1,2,4];d=1;D.retryScheduleIndex<B.length&&(d=B[D.retryScheduleIndex]);D.G=d*1E3+Date.now();D.retryScheduleIndex++}return g.E(U,b75(N,h),0)})},niS=function(N){var h;
return g.c(function(O){if(O.G==1)return g.E(O,NW(N.W,"offlineOrchestrationActionWrapperEntity"),2);h=O.W;return g.E(O,U3S(N,h),0)})},D3K=function(N,h){h.length!==0&&h.forEach(function(O){O=mL(O);
O.retryScheduleIndex<3&&YCR(N.G,[O])})},d34=function(N,h){var O;
return g.c(function(u){if(u.G==1)return g.E(u,NW(N.W,"offlineOrchestrationActionWrapperEntity",h),2);O=u.W;return u.return(O.filter(fJx))})},b75=function(N,h){if(h.length===0)return Promise.resolve([]);
h=h.map(function(O){return IM(O)});
return sGj(N.W,h)},i7r=function(N){this.Vm=N;
this.G=void 0},BfY=function(N,h){var O,u,D,U;
return g.c(function(d){O=h.videoId;u=!0;if(h.captionTracks.length)D=mfY(h),N.G=new g.MH(N.Vm,h,D);else if(h.HX)U=g.US7(h),N.G=new g.ee(N.Vm,h.HX,O,U,h.QJ,h.eventId),u=h.QJ;else return d.return();return d.return(new Promise(function(b){var B;(B=N.G)==null||B.vx({AF:function(){return g.c(function(C){if(C.G==1)return g.E(C,N.AF(O,u),2);b();g.yy(C)})},
Fv:function(){}})}))})},CuR=function(N){var h;
return g.c(function(O){if(O.G==1)return g.E(O,Fno(N),2);h=O.W;return O.return(!!h&&h.length>0)})},Hf=function(N){g.S.call(this);
this.G=N;this.W=this.G.observe(this.U.bind(this))},AeS=function(N,h){var O,u,D,U,d,b,B;
return g.c(function(C){switch(C.G){case 1:if(h.length===0)return C.return([]);O=h.map(function(A){return g.Fv(A,"transfer")});
return g.E(C,NW(N.G,"transfer",O),2);case 2:u=C.W;D=u.filter(fJx).map(function(A){return g.n$(A.key).entityId});
U=h.filter(function(A){return D.indexOf(A)===-1});
if(U.length===0)return C.return([]);d=g.I(U);b=d.next();case 3:if(b.done){C.l0(5);break}B=b.value;return g.E(C,pD4(B),4);case 4:b=d.next();C.l0(3);break;case 5:return C.return(U)}})},Lp4=function(N,h,O,u,D,U){var d,b,B;
return g.c(function(C){d="STREAM_TYPE_UNKNOWN";O.video&&O.audio?(d="STREAM_TYPE_AUDIO_AND_VIDEO",U6("unexpected stream type")):O.video&&!O.audio?d="STREAM_TYPE_VIDEO":!O.video&&O.audio&&(d="STREAM_TYPE_AUDIO");b=g.Fv(h,"offlineVideoStreams");B={numBytesDownloaded:D.toFixed(),numTotalBytes:U.toFixed(),streamType:d,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(u),itag:d==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(O.itag):void 0};return g.E(C,Fd(N,{mode:"readwrite",hd:!0},
function(A){var Q=Wu(A,b,"offlineVideoStreams"),L=Wu(A,g.Fv(h,"transfer"),"transfer");return g.w_.all([Q,L]).then(function(z){z=g.I(z);var v=z.next().value;z=z.next().value;if(!z)return lj(A,b).then(function(){});
var t=oWY(v);v=QOS(v,u,B,b);var R=Y2(A,v,"offlineVideoStreams");oWY(v)>t&&(z.lastProgressTimeMs=Date.now().toString());t=[R];z.offlineVideoStreams||(z.offlineVideoStreams=[]);z.offlineVideoStreams.indexOf(b)===-1&&(z.offlineVideoStreams.push(b),t.push(Y2(A,z,"transfer")));return g.w_.all(t)})}),0)})},zdx=function(N,h){var O,u,D,U,d;
return g.c(function(b){if(b.G==1)return O=g.Fv(h,"offlineVideoStreams"),g.E(b,k2(N,O,"offlineVideoStreams"),2);u=b.W;if(!u||!u.streamsProgress)return b.return();D=g.I(u.streamsProgress);for(U=D.next();!U.done;U=D.next())d=U.value,d.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",d.numTotalBytes!==d.numBytesDownloaded&&(d.numBytesDownloaded=d.numTotalBytes);return g.E(b,Z5(N,u,"offlineVideoStreams"),0)})},QOS=function(N,h,O,u){if(N&&N.streamsProgress){u=N;
a:{h=h.itag+";"+h.xtags;for(var D=N.streamsProgress,U=0;U<D.length;U++){var d=JSON.parse(D[U].formatStreamBytes);if(d.itag+";"+d.xtags===h){D[U]=O;O=D;break a}}D.push(O);O=D}u.streamsProgress=O}else N={key:u,streamsProgress:[O]};return N},oWY=function(N){if(N==null?0:N.streamsProgress){var h=0;
N=N.streamsProgress;for(var O=0;O<N.length;O++){var u=N[O];isNaN(Number(u.numBytesDownloaded))?U6("stream progress bytes number invalid"):h+=Number(u.numBytesDownloaded)}return h}return 0},vWK=function(N,h,O,u){g.S.call(this);
var D=this;this.W=N;this.api=h;this.HB=O;this.fC=u;this.V=new g.HT;this.X=new g.YL(function(){D.G&&D.G.transferState==="TRANSFER_STATE_TRANSFERRING"&&D.V.rA()&&((D.G.transferRetryCount||0)<3?jF(D.B,D.L,!1,!1):Jy(D.B,D.L.videoDetails.videoId),D.x5("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.eS=this.b0=0;this.D=this.Y=!1;this.u0=g.u8(this.api.K().experiments,"html5_transfer_processing_logs_interval");this.O3=new g.yg(this);this.KF={hNC:function(){return D.X},
YSO:function(){return D.fC},
rR:function(){return D.V}};
this.vB=this.W.observe(this.Mm.bind(this));this.B=new Mpr(h,this);this.pC=new i7r(h);this.TO=new Hf(this.W);this.m$=this.V.listen("publicytnetworkstatus-online",this.qE.bind(this));this.FA=this.V.listen("publicytnetworkstatus-offline",this.eym.bind(this));this.D=this.api.K().j("html5_less_transfer_processing_logs");g.H(this,this.O3);this.O3.J(h,"offlinetransferpause",this.GPi);if(g.yv(this.api.K()))this.U="mainVideoDownloadStateEntity";else if(g.qG(this.api.K())||g.Rt(this.api.K()))this.U="musicTrackDownloadMetadataEntity"},
wCj=function(N){return g.c(function(h){if(h.G==1)h=g.E(h,xZ4(),2);
else{var O=N.TO;var u=g.Dt();u=Object.keys(u);O=AeS(O,u);h=g.E(h,O,0)}return h})},Wf=function(N,h){h=h===void 0?!1:h;
var O;return g.c(function(u){if(u.G==1){if(N.G)throw Error("Already downloading a video");N.eS=0;N.Y=!1;return g.E(u,Kpj(N),2)}return u.G!=4?(O=u.W,mmx(N.HB,!O),O&&N.V.rA()?h?g.E(u,new Promise(function(D){g.Cw(D,1E3)}),4):u.l0(4):(!O&&N.G&&Tr(N),u.l0(0))):g.E(u,m3R(N,O),0)})},IMY=function(N){return g.c(function(h){if(h.G==1)return N.L?g.E(h,Jy(N.B,N.L.videoDetails.videoId),3):h.l0(0);
Tr(N);g.yy(h)})},tPx=function(N,h){var O,u,D;
return g.c(function(U){switch(U.G){case 1:return g.Vy(U,2),(O=!!h.captionTracks.length||!!h.HX)?g.E(U,CuR(h.videoId),4):U.return();case 4:return(u=U.W)?U.return():g.E(U,BfY(N.pC,h),5);case 5:g.Mt(U,0);break;case 2:D=g.eo(U),U6("Caption downloading error",D,h.cotn),g.yy(U)}})},m3R=function(N,h){var O,u,D,U,d,b;
return g.c(function(B){switch(B.G){case 1:if(N.Y)return B.return();N.Y=!0;N.G=h;O=g.n$(N.G.key);u=O.entityId;D=void 0;if(N.G.transferState==="TRANSFER_STATE_TRANSFERRING")return g.E(B,Xm(N,u),7);if(N.G.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||N.G.transferRetryCount||N.G.hasLoggedFirstStarted){B.l0(3);break}return g.E(B,Xm(N,u),5);case 5:return D=B.W,N.G.hasLoggedFirstStarted=!0,g.E(B,$3S(N),6);case 6:tDm({videoId:u,w9:N.G,offlineModeType:D},void 0,void 0,!0);B.l0(3);break;case 7:D=B.W,
Bf({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:u,w9:N.G,offlineModeType:D});case 3:return g.E(B,yej(N),8);case 8:return U=null,g.Vy(B,9),g.E(B,VPx(N,h),11);case 11:U=B.W;N.L=U;g.Mt(B,10);break;case 9:return d=g.eo(B),U6("error getting player response",d,h.cotn),g.E(B,N.x5("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return B.return();case 10:return b=p8R(N.api.K(),h.cotn,U),g.E(B,tPx(N,b),13);case 13:return g.E(B,eGS(b.videoId),
14);case 14:b.uA=B.W,qCn(N.B,b,h.maximumDownloadQuality),N.X.start(108E5),g.yy(B)}})},Kpj=function(N){var h,O;
return g.c(function(u){if(u.G==1)return g.E(u,NW(N.W,"transfer"),2);h=u.W;O=h.filter(Rd5).sort(Pur);return O.length===0?u.return():u.return(O[0])})},yej=function(N){var h,O,u;
return g.c(function(D){if(D.G==1){if(!N.G)return ff(N,"onTransferStart"),D.return();N.X.start(108E5);return g.E(D,Yc(N,"TRANSFER_STATE_TRANSFERRING"),2)}h=N.G;return(u=((O=h)==null?0:O.key)?g.n$(h.key).entityId:"")&&N.U?g.E(D,Lf(u,N.U,N.W,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):D.l0(0)})},chj=function(N){var h,O,u,D;
g.c(function(U){switch(U.G){case 1:if(!N.G){ff(N,"onTransferPausedByUser");U.l0(2);break}h=N.G;N.X.stop();return g.E(U,Yc(N,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:u=((O=h)==null?0:O.key)?g.n$(h.key).entityId:"";if(!u||!N.U){U.l0(4);break}return g.E(U,Lf(u,N.U,N.W,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.E(U,Xm(N,u),6);case 6:D=U.W,y0V({videoId:u,w9:h,offlineModeType:D});case 2:Tr(N),Wf(N),g.yy(U)}})},aGK=function(N){var h,O,u;
g.c(function(D){if(D.G==1){if(!N.G)return ff(N,"onTransferPausedByNetwork"),D.return();N.X.stop();return g.E(D,Yc(N,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(D.G!=3)return h=N.G,(u=((O=h)==null?0:O.key)?g.n$(h.key).entityId:"")&&N.U?g.E(D,Lf(u,N.U,N.W,"DOWNLOAD_STATE_PAUSED"),3):D.l0(3);Tr(N);g.yy(D)})},MPR=function(N){var h,O,u,D,U;
g.c(function(d){switch(d.G){case 1:if(!N.G)return ff(N,"onTransferComplete"),d.return();h=N.G;N.X.stop();if(!h||!N.L){d.l0(2);break}O=p8R(N.api.K(),h.cotn,N.L);return g.E(d,tPx(N,O),2);case 2:return g.E(d,Yc(N,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:D=((u=h)==null?0:u.key)?g.n$(h.key).entityId:"";if(!D||!N.U){d.l0(5);break}return g.E(d,Lf(D,N.U,N.W,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.E(d,zdx(N.W,D),7);case 7:return g.E(d,Xm(N,D),8);case 8:U=d.W,Bf({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:D,w9:h,offlineModeType:U}),Tr(N),Wf(N),g.yy(d)}})},pC5=function(N,h,O){var u,D;
g.c(function(U){switch(U.G){case 1:if(!N.G)return ff(N,"onTransferProgress: "+h),U.return();if(N.G.transferState==="TRANSFER_STATE_TRANSFERRING"){U.l0(2);break}return g.E(U,yej(N),2);case 2:u=Date.now();if(!(u-N.b0>1E3)){U.l0(4);break}N.b0=u;return g.E(U,Lp4(N.W,O.videoId,O.W,O.I3,O.bytesDownloaded,O.G),5);case 5:if(N.D&&!(N.D&&u-N.eS>N.u0)){U.l0(4);break}N.eS=u;return g.E(U,Xm(N,h),7);case 7:D=U.W,tDm({videoId:h,w9:N.G,offlineModeType:D},O.bytesDownloaded,O.G);case 4:N.X.start(108E5),g.yy(U)}})},
edY=function(N){var h=(N.G.transferRetryCount||0)<3;
h&&(N=N.G,N.transferRetryCount=(N.transferRetryCount||0)+1);return h},EWo=function(N,h){h=h===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":h;
var O,u,D,U;return g.c(function(d){if(d.G==1)return N.G||ff(N,"setTransferToFailed: "+h),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h==="TRANSFER_FAILURE_REASON_NETWORK"?O="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":h==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.E(d,Yc(N,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",h),2);if(d.G!=3)return Gr(N.fC,{entityKey:(u=N.G)==null?void 0:u.key,failureReason:O}),
D=N.G?g.n$(N.G.key).entityId:"",g.E(d,Xm(N,D),3);U=d.W;var b={videoId:D,w9:N.G,offlineModeType:U},B=h,C={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};B&&(C.transferFailureReason=B,C.failureReason=VDm(B));Bf(C,b);g.yy(d)})},Yc=function(N,h,O,u){var D;
return g.c(function(U){if(U.G==1){if(!N.G)return ff(N,"saveTransferState: "+h),U.return();N.G.transferState=h;N.G.failureReason=u;g.Vy(U,2);return g.E(U,$3S(N,function(d){return O?Xd(d,"offlineVideoStreams",N.G.offlineVideoStreams).then(function(b){for(var B=g.I(b),C=B.next();!C.done;C=B.next())if((C=C.value)&&C.streamsProgress){C=g.I(C.streamsProgress);for(var A=C.next();!A.done;A=C.next())A.value.streamState=O}return MWR(d,b.filter(function(Q){return!!Q}),"offlineVideoStreams")}):g.w_.resolve(void 0)}),
4)}if(U.G!=2)return g.Mt(U,0);
D=g.eo(U);return D instanceof g.CV&&D.type==="QUOTA_EXCEEDED"?g.E(U,N.x5("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):U.l0(0)})},$3S=function(N,h){var O;
return g.c(function(u){if(!N.G)return u.return();O=N.G;return g.E(u,Fd(N.W,{mode:"readwrite",hd:!0},function(D){var U=[Y2(D,O,"transfer")];h&&U.push(h(D));return g.w_.all(U)}),0)})},Tr=function(N){N.G=void 0;
N.L=void 0;N.X.stop()},VPx=function(N,h){var O,u,D,U,d;
return g.c(function(b){if(b.G==1)return O=g.n$(h.key),u=O.entityId,D=g.Fv(u,"playbackData"),g.E(b,k2(N.W,D,"playbackData"),2);U=b.W;if((d=U)==null?0:d.playerResponseJson)return b.return(JSON.parse(U.playerResponseJson));throw Error("No PlayerResponse found");})},ff=function(N,h){N.api.GO("woffle",{mcte:h});
U6("missing current transfer entity.")},Xm=function(N,h){var O,u,D;
return g.c(function(U){if(U.G==1)return g.E(U,k2(N.W,g.Fv(h,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);O=U.W;return U.return((D=(u=O)==null?void 0:u.offlineModeType)!=null?D:void 0)})},Rd5=function(N){return ce5[N.transferState]!==void 0},Pur=function(N,h){var O=ce5[N.transferState],u=ce5[h.transferState];
return O!==u?O-u:Number(N.enqueuedTimestampMs)-Number(h.enqueuedTimestampMs)},lJ=function(N,h){var O=this;
this.Qm=N;this.api=h;this.V=new g.HT;this.L=new g.oG;this.KF={i8:function(){return O.U.KF.i8()},
rR:function(){return O.V},
kNm:function(){return O.U},
R4:function(){return O.R4()},
Ei:function(){return O.Ei()},
kL:function(){return O.kL()},
qe:function(){return O.qe()},
aK:function(){return O.aK()},
D2:function(u){return O.D2(u)}};
this.U=new zvY(function(){return aMx(O)},function(){O.kL()},this.api.M3(),this.api.j.bind(this.api));
this.G=new dL(this.api);vLY(this.U)},aMx=function(N){return g.c(function(h){N.api.wf("onOrchestrationBecameLeader");
return g.E(h,N.Ei(),0)})},gWS=function(N){var h,O;
return g.c(function(u){if(u.G==1)return g.E(u,hy(),2);if(u.G!=3){h=u.W;if(!h)return U6("PES is undefined"),u.return();N.W=new vWK(h,N.api,N.U,N.G);O=N.VM(h);return g.E(u,Zdn(h,O,N.U,N.G,N.Qm),3)}N.B=u.W;return g.E(u,qAS(N),0)})},qAS=function(N){var h;
return g.c(function(O){switch(O.G){case 1:if(!N.W)return U6("transferManager is undefined"),O.return();if(N.W.G){O.l0(2);break}return g.E(O,Wf(N.W),2);case 2:if(!N.Qm.j("woffle_enable_main_downloads_library")){O.l0(4);break}return g.E(O,N.WG(),4);case 4:if(!N.Qm.j("html5_offline_playback_position_sync")){O.l0(6);break}return g.E(O,N.Hd(),7);case 7:return g.E(O,N.D2(864E5),6);case 6:return g.E(O,N.refreshAllStaleEntities(43200,!0),9);case 9:return g.E(O,N.f2(),10);case 10:if(!N.Qm.j("html5_retry_downloads_for_expiration")){O.l0(11);
break}return g.E(O,N.aK(),11);case 11:return N.Y=g.AY(function(){N.refreshAllStaleEntities(43200,!0);N.f2()},9E5),g.Ye(g.xe(),function(){return N.qe()}),g.E(O,hy(),13);
case 13:return h=O.W,g.E(O,LDo(h),14);case 14:w8r(N.U),g.yy(O)}})},reY=function(){var N,h,O,u,D,U;
return g.c(function(d){switch(d.G){case 1:return g.E(d,hy(),2);case 2:N=d.W;if(!N)return d.return([]);h=Date.now()/1E3;return g.E(d,NW(N,"offlineVideoPolicy"),3);case 3:O=d.W,u=g.I(O),D=u.next();case 4:if(D.done){d.l0(6);break}U=D.value;if(!(U.expirationTimestamp&&Number(U.expirationTimestamp)<h)){d.l0(5);break}U.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";U.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.E(d,Z5(N,U,"offlineVideoPolicy"),5);
case 5:D=u.next();d.l0(4);break;case 6:return d.return(O.map(function(b){return b.key}))}})},xc=function(N,h,O,u,D){var U,d,b;
return g.c(function(B){if(B.G==1)return g.E(B,hy(),2);U=B.W;if(!U)return B.return([]);d=h.map(function(C){var A=g.Fv(C,O);A={actionType:u,entityKey:A,actionMetadata:Object.assign({},evS(),D)};u!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(A.actionMetadata.priority=0);C=new Kf(O,C,A);return IM(C)});
b=sGj(U,d);vLY(N.U);return B.return(b)})},sOm=function(N,h,O,u){var D,U,d,b,B,C,A,Q;
return g.c(function(L){switch(L.G){case 1:D=[],U=g.I(h),d=U.next();case 2:if(d.done){L.l0(4);break}b=d.value;if(b.upToDate||O&&!b.shouldAutoSyncMetadata||!b.playlistId){L.l0(3);break}B={};switch(u){case "mainPlaylistEntity":C={nextAutoRefreshIntervalSeconds:b.checkInSeconds,autoSync:O};B={mainPlaylistEntityActionMetadata:C};break;case "musicPlaylist":A={autoSync:O},B={musicPlaylistEntityActionMetadata:A}}return g.E(L,xc(N,[b.playlistId],u,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B),6);case 6:(Q=
L.W)&&D.push.apply(D,g.Lx(Q));case 3:d=U.next();L.l0(2);break;case 4:return L.return(D)}})},JeK=function(N,h){var O;
return g.c(function(u){return h.length?(O=evS(),g.qs(O,rL,{isEnqueuedForExpiredStreamUrlRefetch:!0}),N.api.GO("qrd",{v:h.length}),u.return(xc(N,h,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O))):u.return([])})},jOj=function(N,h,O){this.G=N;
this.Qm=h;this.U=O},Tfr=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M;
return g.c(function(a){switch(a.G){case 1:return O=Cf(h),u=g.n$(h.entityKey),D=u.entityId,U=[],g.Vy(a,2),g.E(a,SAK(N,D),4);case 4:U=a.W;if(!(N.Qm.j("woffle_enable_main_downloads_library")&&((d=U)==null?0:d.length))){a.l0(5);break}return g.E(a,WDr(N.G,[h.entityKey]),5);case 5:g.Mt(a,3);break;case 2:return b=g.eo(a),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.CV&&b.type==="QUOTA_EXCEEDED"?(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):U6("Playlist add error"),a.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,B,C));case 3:A=[];if(!N.Qm.j("html5_offline_prevent_redownload_downloaded_video")){a.l0(7);break}return g.E(a,MD4(N.G,"mainVideoEntity",U),8);case 8:U=a.W;case 7:if((Q=U)==null?0:Q.length)for(L=g.I(U),z=L.next();!z.done;z=L.next())if(v=z.value,t=v.offlineVideoData,R=void 0,(R=t)==null?0:R.videoId)p=void 0,M=Number(((p=h.actionMetadata)==null?void 0:p.priority)||
0)+1,A.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t.videoId,"mainVideoEntity",M,nf,H74(h,t,D)));return a.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,A))}})},XCY=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY,BR,oe,Oa,Ea,nx,or,CS,fx,ae,Gi,sR,XV,bl,e,Ti,ar,uY,Rr,y,hd,PH,nZ,Sx,lY,OR,Dr,WH,V,m,P,q,T,td,x,k,r,Kx,Ir,GZ,iS,xp,PR,OY,V4,Jj,px,Vt,cR,q5,Po;
return g.c(function(il){switch(il.G){case 1:return O=Cf(h),u=h.entityKey,D=g.n$(u).entityId,U=[],d=!1,D==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.E(il,NW(N.G,"mainPlaylistEntity"),5)):g.E(il,k2(N.G,u,"mainPlaylistEntity"),4);case 4:(b=il.W)&&U.push(b);il.l0(3);break;case 5:U=il.W;case 3:if((B=U)==null||!B.length)return il.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));C=g.X(h.actionMetadata,WpS);Q=(A=C)==null?void 0:A.nextAutoRefreshIntervalSeconds;z=(L=C)==null?void 0:L.autoSync;v=[];R=t=
!0;p=!1;if(!d&&z===!1){il.l0(6);break}g.Vy(il,7);return g.E(il,DxY(0,!!z,!0,U),9);case 9:v=il.W;g.Mt(il,8);break;case 7:M=g.eo(il);if(!(M instanceof Error&&M.message==="No data")){M instanceof Error&&M.message==="Empty response body"&&U6(M.message);il.l0(8);break}return D==="!*$_ALL_ENTITIES_!*$"?g.E(il,s9r(N.G,h,N.U,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.E(il,gLo(D,N.G,h,N.U),8);case 8:if(!v.length||!d&&v[0].playlistId!==D)return il.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O));case 6:if(d){a=[];J=g.I(v);for(W=J.next();!W.done;W=J.next())F=W.value,F.upToDate||z&&!F.shouldAutoSyncMetadata||!F.playlistId||(l={nextAutoRefreshIntervalSeconds:F.checkInSeconds,autoSync:z},a.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",F.playlistId,"mainPlaylistEntity",0,nf,{mainPlaylistEntityActionMetadata:l})));return il.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,a))}v.length&&(iY=v[0],p=!!iY.upToDate,z&&(t=(bY=iY.shouldAutoSyncMetadata)!=null?bY:!0,R=(BR=iY.shouldAutoSyncVideos)!=
null?BR:!0,iY.checkInSeconds&&(Q=iY.checkInSeconds)));if(p||!t)return il.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));oe=[];Oa=U[0];if(!Oa.downloadState){Ea=void 0;il.l0(15);break}return g.E(il,k2(N.G,Oa.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Ea=il.W;case 15:return nx=Ea,CS=((or=nx)==null?0:or.addedTimestampMillis)?String(nx.addedTimestampMillis):void 0,g.Vy(il,17),g.E(il,SAK(N,D,CS,Q),19);case 19:oe=il.W;g.Mt(il,18);break;case 17:fx=g.eo(il);if(!(fx instanceof
Error&&fx.message==="No data for playlist")){if(fx instanceof Error&&fx.message==="Empty response body for playlist")U6(fx.message);else return ae="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Gi="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",fx instanceof g.CV&&fx.type==="QUOTA_EXCEEDED"&&(ae="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Gi="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),il.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,ae,Gi));
il.l0(18);break}return g.E(il,gLo(D,N.G,h,N.U),18);case 18:if(!R)return il.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));sR=[];XV=new Map;if((bl=oe)==null?0:bl.length)for(e=g.I(oe),Ti=e.next();!Ti.done;Ti=e.next())ar=Ti.value,uY=ar.offlineVideoData,Rr=void 0,((Rr=uY)==null?0:Rr.videoId)&&XV.set(uY.videoId,uY);y=new Map;hd=[];if((PH=Oa)==null?0:(nZ=PH.videos)==null?0:nZ.length)for(Sx=g.I(Oa.videos),lY=Sx.next();!lY.done;lY=Sx.next())if(OR=lY.value,Dr=JSON.parse(g.n$(OR).entityId),
WH=Dr.videoId)XV.has(WH)?(y.set(WH,XV.get(WH)),XV.delete(WH)):hd.push(WH);m=Number(((V=h.actionMetadata)==null?void 0:V.priority)||0)+1;P=g.I(XV.entries());for(q=P.next();!q.done;q=P.next())T=q.value,td=g.I(T),x=td.next().value,k=td.next().value,r=x,Kx=k,sR.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",r,"mainVideoEntity",m,nf,H74(h,Kx,D)));Ir=g.I(y.entries());for(GZ=Ir.next();!GZ.done;GZ=Ir.next())iS=GZ.value,xp=g.I(iS),PR=xp.next().value,OY=xp.next().value,V4=PR,Jj=OY,sR.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
V4,"mainVideoEntity",m,nf,H74(h,Jj,D)));px=g.I(hd);for(Vt=px.next();!Vt.done;Vt=px.next())cR=Vt.value,q5={playlistId:D},Po={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:q5},sR.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",cR,"mainVideoEntity",0,nf,Po));return il.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,sR))}})},fMK=function(N,h){var O,u,D,U;
return g.c(function(d){switch(d.G){case 1:return O=Cf(h),g.Vy(d,2),u=g.n$(h.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.E(d,s9r(N.G,h,N.U,(D=h.actionMetadata)==null?void 0:(U=D.offlineLoggingData)==null?void 0:U.offlineDeleteReason),5):g.E(d,gLo(u,N.G,h,N.U),6);case 6:if(!N.Qm.j("woffle_enable_main_downloads_library")){d.l0(5);break}return g.E(d,X8Y(N.G,h.entityKey),5);case 5:g.Mt(d,3);break;case 2:return g.eo(d),d.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},SAK=function(N,h,O,u){var D,U,d,b,B,C,A;
return g.c(function(Q){switch(Q.G){case 1:return g.E(Q,OdK([h]),2);case 2:return D=Q.W,g.E(Q,YAK(N,D[0],O,u),3);case 3:return U=Q.W,d=U.mainPlaylistEntity,b=U.XIB,C=ax4(d,(B=b)==null?void 0:B.avatar),g.Vy(Q,4),g.E(Q,$c(C),6);case 6:g.Mt(Q,5);break;case 4:A=g.eo(Q),A instanceof Error&&A.message==="Failed to fetch"&&U6(A.message);case 5:return Q.return(D[0].videos)}})},YAK=function(N,h,O,u){var D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J;
return g.c(function(W){switch(W.G){case 1:D=Date.now().toString();O||(O=D);U=h.videos;d=h.playlistId;b=[];B=[];if(U)for(C=g.I(U),A=C.next();!A.done;A=C.next()){Q=A.value;L=Q.offlineVideoData;if(!L||!L.videoId)throw U6("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");z=L.videoId;v={videoId:z,playlistId:d};t={id:g.Fv(JSON.stringify(v),"mainPlaylistVideoEntity"),video:g.Fv(z,"mainVideoEntity")};b.push(t);B.push(t.id)}p={key:g.Fv(d,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:O,lastSyncedTimestampMillis:D};M={key:g.Fv(d,"mainPlaylistEntity"),playlistId:d,videos:B,title:h.title,thumbnailStyleData:lMx(h),visibility:x35(h),downloadState:p.key};h.channel&&(a=h.channel.offlineChannelData,R=nWY(g.Fv(d,"ytMainChannelEntity"),a),M.channelOwner=R.id);((J=M)==null?0:J.entityMetadata)?(M.entityMetadata.offlineLastModifiedTimestampSeconds=h.lastModifiedTimestamp,u&&(M.entityMetadata.nextAutoRefreshIntervalSeconds=String(u))):M&&(M.entityMetadata={nextAutoRefreshIntervalSeconds:u?
String(u):void 0,offlineLastModifiedTimestampSeconds:h.lastModifiedTimestamp});g.Vy(W,2);return g.E(W,Fd(N.G,{mode:"readwrite",hd:!0},function(F){var l=Y2(F,M,"mainPlaylistEntity"),iY=Y2(F,p,"mainPlaylistDownloadStateEntity");l=[l,iY];iY=g.I(b);for(var bY=iY.next();!bY.done;bY=iY.next())l.push(Y2(F,bY.value,"mainPlaylistVideoEntity"));R&&l.push(Y2(F,R,"ytMainChannelEntity"));return g.w_.all(l)}),4);
case 4:g.Mt(W,3);break;case 2:throw g.eo(W),U6("PES failure for playlist"),Error("PES failure for playlist");case 3:return W.return({mainPlaylistEntity:M,XIB:R,Lvi:b})}})},nWY=function(N,h){return{id:N,
channelId:h.channelId,title:h.title,avatar:h.thumbnail}},lMx=function(N){var h=[],O=N.videos;
O&&O.length>0&&h.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:O[0].offlineVideoData.thumbnail}}});if((N=N.additionalMetadadatas)&&N.length>0)for(N=g.I(N),O=N.next();!O.done;O=N.next()){var u=O.value.offlineBundleItemPlaylistData,D=void 0;O=(D=u)==null?void 0:D.style;D=void 0;u={collageThumbnail:{coverThumbnail:(D=u)==null?void 0:D.coverThumbnail}};switch(O){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":h.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:u});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":h.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:u});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":h.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:u});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":h.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:u})}}return h},x35=function(N){switch(N.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},H74=function(N,h,O){h={offlineVideoData:h,
playlistId:O};if(N=g.X(N.actionMetadata,WpS))h.maximumDownloadQuality=N.maximumDownloadQuality;return{mainVideoEntityActionMetadata:h}},FpV=function(N,h,O){this.G=N;
this.Qm=h;this.U=O},Ntm=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v;
return g.c(function(t){switch(t.G){case 1:return O=Cf(h),u=g.n$(h.entityKey),D=u.entityId,U=g.X(h.actionMetadata,Fm),b=!((d=U)==null?0:d.playlistId),g.Vy(t,2),g.E(t,Z7x(N,D,void 0,(B=U)==null?void 0:B.offlineVideoData,b),4);case 4:g.Mt(t,3);break;case 2:return C=g.eo(t),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.CV&&C.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
t.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,A,Q));case 3:L=1;L=Number(((z=h.actionMetadata)==null?void 0:z.priority)||0)+1;var R=(R=g.X(h.actionMetadata,Fm))?{playbackDataActionMetadata:{maximumDownloadQuality:R.maximumDownloadQuality}}:void 0;v=qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",D,"playbackData",L,kbS,R);return t.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,[v]))}})},h0o=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M;
return g.c(function(a){switch(a.G){case 1:return O=Cf(h),u=g.n$(h.entityKey),D=u.entityId,g.E(a,k2(N.G,h.entityKey,"mainVideoEntity"),2);case 2:U=a.W;if(!U){d=void 0;a.l0(3);break}return g.E(a,k2(N.G,U.downloadState,"mainVideoDownloadStateEntity"),4);case 4:d=a.W;case 3:b=d;if(!U||!b)return a.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.Vy(a,5);return g.E(a,Z7x(N,D,b.addedTimestampMillis,(C=g.X(h.actionMetadata,Fm))==null?void 0:C.offlineVideoData),7);case 7:A=1;A=Number(((Q=
h.actionMetadata)==null?void 0:Q.priority)||0)+1;B=qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D,"playbackData",A,kbS);g.Mt(a,6);break;case 5:L=g.eo(a);if(!(L instanceof Error&&L.message==="No data")){if(L instanceof Error&&L.message==="Empty response body")U6(L.message);else return z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.CV&&L.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),a.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,z,v));a.l0(6);break}return g.E(a,RM(N.G,D),9);case 9:t=a.W;R=g.X(h.actionMetadata,Fm);if(M=(p=R)==null?void 0:p.playlistId)t.playlistId=M;t.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.E(a,yw(D,N.G,h,N.U,t),6);case 6:return a.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,B?[B]:void 0))}})},Own=function(N,h){var O,u,D,U,d,b,B,C,A,Q;
return g.c(function(L){switch(L.G){case 1:return O=Cf(h),g.Vy(L,2),u=g.n$(h.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.E(L,s9r(N.G,h,N.U,(A=h.actionMetadata)==null?void 0:(Q=A.offlineLoggingData)==null?void 0:Q.offlineDeleteReason),5):g.E(L,RM(N.G,u),6);case 6:D=L.W;U=g.X(h.actionMetadata,Fm);if(b=(d=U)==null?void 0:d.playlistId)D.playlistId=b;D.offlineDeleteReason=(B=h.actionMetadata)==null?void 0:(C=B.offlineLoggingData)==null?void 0:C.offlineDeleteReason;return g.E(L,yw(u,N.G,h,N.U,D),7);
case 7:if(!N.Qm.j("woffle_enable_main_downloads_library")){L.l0(5);break}return g.E(L,X8Y(N.G,h.entityKey),5);case 5:g.Mt(L,3);break;case 2:return g.eo(L),L.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return L.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},Z7x=function(N,h,O,u,D){var U,d,b,B,C,A;
return g.c(function(Q){switch(Q.G){case 1:if(U=u){Q.l0(2);break}return g.E(Q,hGR([h]),3);case 3:d=Q.W,U=d[0];case 2:return g.E(Q,u5S(N,U,O,D),4);case 4:b=Q.W;B=b.mainVideoEntity;C=b.channelEntity;g.Vy(Q,5);var L=wL(B.thumbnail),z=wL(C.avatar);return g.E(Q,$c(L.concat(z)),7);case 7:g.Mt(Q,0);break;case 5:A=g.eo(Q),A instanceof Error&&A.message==="Failed to fetch"&&U6(A.message),g.yy(Q)}})},u5S=function(N,h,O,u){var D,U,d,b,B,C,A,Q,L,z,v,t,R;
return g.c(function(p){switch(p.G){case 1:O||(O=Date.now().toString());U=(D=h.channel)==null?void 0:D.offlineChannelData;d={id:g.Fv(h.videoId,"ytMainChannelEntity"),channelId:U.channelId,title:U.title,avatar:U.thumbnail};b={key:g.Fv(h.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Fv(h.videoId,"playbackData"),addedTimestampMillis:O,videoDownloadContextEntity:g.Fv(h.videoId,"videoDownloadContextEntity")};B={key:g.Fv(h.videoId,"videoPlaybackPositionEntity"),videoId:h.videoId,lastPlaybackPositionSeconds:"0"};
N.Qm.j("html5_offline_playback_position_sync")&&(C={playbackPosition:B.key});A=g.Fv(h.videoId,"mainVideoEntity");Q={key:A,videoId:h.videoId,title:h.title,thumbnail:h.thumbnail,localizedStrings:{viewCount:h.shortViewCountText},userState:C,lengthSeconds:h.lengthSeconds?Number(h.lengthSeconds):void 0,publishedTimestampMillis:h.publishedTimestamp?(Number(h.publishedTimestamp)*1E3).toString():void 0,formattedDescription:h.description,owner:d.id,downloadState:b.key};if(!N.Qm.j("woffle_enable_main_downloads_library")||
!u){p.l0(2);break}return g.E(p,TOR(N.G,[A]),3);case 3:if(v=p.W)L=v.mainDownloadsLibraryEntity,z=v.mainDownloadsListEntity;case 2:return R=PaS,t={key:g.Fv(h.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.qs(b,R,t),g.E(p,Fd(N.G,{mode:"readwrite",hd:!0},function(M){var a=Y2(M,d,"ytMainChannelEntity"),J=Y2(M,b,"mainVideoDownloadStateEntity"),W=Y2(M,Q,"mainVideoEntity");a=[a,J,W];N.Qm.j("html5_offline_playback_position_sync")&&(J=Y2(M,B,"videoPlaybackPositionEntity"),
a.push(J));L&&(J=Y2(M,L,"mainDownloadsLibraryEntity"),a.push(J));z&&(J=Y2(M,z,"mainDownloadsListEntity"),a.push(J));t&&(M=Y2(M,t,"downloadStatusEntity"),a.push(M));return g.w_.all(a)}),4);
case 4:return p.return({mainVideoEntity:Q,channelEntity:d})}})},Dqr=function(N,h,O){this.G=N;
this.Qm=h;this.U=O},dqS=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY,BR,oe,Oa;
return g.c(function(Ea){switch(Ea.G){case 1:return O=Cf(h),u=[],g.E(Ea,Su.getInstance(),2);case 2:D=Ea.W;if(!D){Ea.l0(3);break}return g.E(Ea,D.get("sdois"),4);case 4:return U=Ea.W,g.E(Ea,(b=D)==null?void 0:b.get("lmqf"),5);case 5:d=Ea.W;case 3:g.Vy(Ea,6);if(U===void 0)throw Error("prefStorage or opt-in state is undefined");B=[];if(U){Ea.l0(8);break}return g.E(Ea,Hzj(N.G),9);case 9:B=Ea.W,B.reverse();case 8:if(!B.length){Ea.l0(10);break}C=g.I(B);A=C.next();case 11:if(A.done){Ea.l0(10);break}Q=A.value;
if(!Q){Ea.l0(12);break}L=g.n$(Q).entityId;return g.E(Ea,RM(N.G,L),14);case 14:return z=Ea.W,z.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.E(Ea,yw(L,N.G,{entityKey:Q,actionType:h.actionType},N.U,z),12);case 12:A=C.next();Ea.l0(11);break;case 10:return g.E(Ea,dx5(U,(v=d)!=null?v:"SD"),16);case 16:return t=Ea.W,g.E(Ea,J0r(t),17);case 17:R=Shx(t);if(!N.Qm.j("woffle_enable_main_downloads_library")){Ea.l0(18);break}if(U){Ea.l0(19);break}return g.E(Ea,X8Y(N.G,g.Jk),19);case 19:return g.E(Ea,
WDr(N.G,[g.Jk]),18);case 18:if((p=R)==null?0:p.length)for(M=g.I(R),a=M.next();!a.done;a=M.next())if(W=J=a.value,F=W.actionType,l=W.entityKey,iY=W.actionMetadata,F&&l&&iY&&!g.X(iY,Uqj)){F==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(iY.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(bY=g.X(J.actionMetadata,Fm))bY.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",J.actionMetadata=Object.assign({},J.actionMetadata,{mainVideoEntityActionMetadata:bY});u.push(J)}g.Mt(Ea,
7);break;case 6:return BR=g.eo(Ea),oe="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Oa="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",BR instanceof g.CV&&BR.type==="QUOTA_EXCEEDED"&&(oe="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Oa="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ea.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,oe,Oa));case 7:return Ea.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,u))}})},G8V=function(){lJ.apply(this,
arguments);
this.D="mainVideoEntity"},bwr=function(N,h,O){h=h===void 0?43200:h;
O=O===void 0?!0:O;var u=u===void 0?!1:u;var D,U,d;return g.c(function(b){switch(b.G){case 1:if(!N.V.rA())return b.return([]);D=[];g.Vy(b,2);return g.E(b,DxY(h,O,u),4);case 4:D=b.W;g.Mt(b,3);break;case 2:U=g.eo(b),U instanceof Error&&U.message==="No data"||U instanceof Error&&U.message==="Empty response body"&&U6(U.message);case 3:return d=sOm(N,D,O,"mainPlaylistEntity"),b.return(d)}})},iwY=function(N,h,O,u){u=u===void 0?!1:u;
var D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M;return g.c(function(a){switch(a.G){case 1:return D=[],g.E(a,Ux4(),2);case 2:return(U=a.W)||u?g.E(a,GCY(h,O),3):a.return([]);case 3:d=a.W;if((b=d)==null||!b.length)return a.return([]);B={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};C=g.I(d);A=C.next();case 4:if(A.done){a.l0(6);break}L=Q=A.value;z=L.actionType;v=L.entityKey;t=L.actionMetadata;if(!(z&&v&&t)||g.X(t,Uqj)){a.l0(5);break}z==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(t.offlineLoggingData=
B);R=g.n$(v);p=R.entityId;return g.E(a,xc(N,[p],"mainVideoEntity",z,t),8);case 8:M=a.W,D=D.concat(M);case 5:A=C.next();a.l0(4);break;case 6:return a.return(D)}})},Bt5=function(N,h){this.G=N;
this.U=h},AYS=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p;
return g.c(function(M){switch(M.G){case 1:return O=Cf(h),u=g.n$(h.entityKey),D=u.entityId,U=[],g.Vy(M,2),g.E(M,CFo(N,D),4);case 4:U=M.W;if((d=U)==null||!d.length){M.l0(5);break}return g.E(M,nLj(N.G,h.entityKey),5);case 5:g.Mt(M,3);break;case 2:return b=g.eo(M),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.CV&&b.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
M.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,B,C));case 3:return A=[],g.E(M,MD4(N.G,"musicTrack",U),7);case 7:U=M.W;if(U.length)for(Q=g.I(U),L=Q.next();!L.done;L=Q.next())if(z=L.value,v=z.offlineVideoData,t=void 0,(t=v)==null?0:t.videoId)R=void 0,p=Number(((R=h.actionMetadata)==null?void 0:R.priority)||0)+1,A.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",v.videoId,"musicTrack",p,Zk,eF(h,v,D)));return M.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,A))}})},
oCY=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY,BR,oe,Oa,Ea,nx,or,CS,fx,ae,Gi,sR,XV,bl,e,Ti,ar,uY,Rr,y,hd,PH,nZ,Sx,lY,OR,Dr,WH,V,m,P,q,T,td,x,k;
return g.c(function(r){switch(r.G){case 1:return O=Cf(h),u=h.entityKey,D=g.n$(u).entityId,U=[],d=!1,D==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.E(r,NW(N.G,"musicAlbumRelease"),5)):g.E(r,k2(N.G,u,"musicAlbumRelease"),4);case 4:(b=r.W)&&U.push(b);r.l0(3);break;case 5:U=r.W;case 3:if((B=U)==null||!B.length)return r.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));if(d){C=[];A=g.I(U);for(Q=A.next();!Q.done;Q=A.next())L=Q.value,z=g.n$(L.id).entityId,C.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
z,"musicAlbumRelease",0,Zk));return r.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,C))}v=[];t=U[0];R=void 0;if(!t.downloadMetadata){r.l0(6);break}return g.E(r,k2(N.G,t.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:p=r.W,R=Number((a=(M=p)==null?void 0:M.addedTimestampMillis)!=null?a:"0")/1E3;case 6:return g.Vy(r,8),g.E(r,CFo(N,D,(J=R)==null?void 0:J.toString()),10);case 10:v=r.W;g.Mt(r,9);break;case 8:W=g.eo(r);if(!(W instanceof Error&&W.message==="No data")){if(W instanceof
Error&&W.message==="Empty response body")U6(W.message);else return F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.CV&&W.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),r.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,F,l));r.l0(9);break}return g.E(r,MW(D,"musicAlbumRelease",N.G,h,N.U),9);case 9:iY=[];bY=new Map;
if((BR=v)==null?0:BR.length)for(oe=g.I(v),Oa=oe.next();!Oa.done;Oa=oe.next())Ea=Oa.value,nx=Ea.offlineVideoData,or=void 0,((or=nx)==null?0:or.videoId)&&bY.set(nx.videoId,nx);CS=new Map;fx=[];if((ae=t)==null?0:(Gi=ae.tracks)==null?0:Gi.length)for(sR=g.I(t.tracks),XV=sR.next();!XV.done;XV=sR.next())if(bl=XV.value,e=g.n$(bl).entityId)bY.has(e)?(CS.set(e,bY.get(e)),bY.delete(e)):fx.push(e);ar=Number(((Ti=h.actionMetadata)==null?void 0:Ti.priority)||0)+1;uY=g.I(bY.entries());for(Rr=uY.next();!Rr.done;Rr=
uY.next())y=Rr.value,hd=g.I(y),PH=hd.next().value,nZ=hd.next().value,Sx=PH,lY=nZ,iY.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Sx,"musicTrack",ar,Zk,eF(h,lY)));OR=g.I(CS.entries());for(Dr=OR.next();!Dr.done;Dr=OR.next())WH=Dr.value,V=g.I(WH),m=V.next().value,P=V.next().value,q=m,T=P,iY.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q,"musicTrack",ar,Zk,eF(h,T)));td=g.I(fx);for(x=td.next();!x.done;x=td.next())k=x.value,iY.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",k,"musicTrack",
0,Zk));return r.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,iY))}})},QQj=function(N,h){var O,u;
return g.c(function(D){switch(D.G){case 1:return O=Cf(h),g.Vy(D,2),u=g.n$(h.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.E(D,pf(N.G,h,N.U),5):g.E(D,MW(u,"musicAlbumRelease",N.G,h,N.U),6);case 6:return g.E(D,FD5(N.G,h.entityKey),5);case 5:g.Mt(D,3);break;case 2:return g.eo(D),D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},CFo=function(N,h,O){var u,D,U;
return g.c(function(d){switch(d.G){case 1:return g.E(d,OdK([h]),2);case 2:return u=d.W,g.E(d,LbR(N,u[0],O),3);case 3:return D=d.W,U=wL(D.thumbnailDetails),g.E(d,$c(U),4);case 4:return d.return(u[0].videos)}})},LbR=function(N,h,O){var u,D,U,d,b,B,C,A,Q,L,z,v,t,R;
return g.c(function(p){if(p.G==1){u=h.additionalMetadadatas;D=void 0;if(u&&u.length>0)for(U=g.I(u),d=U.next();!d.done;d=U.next())if(b=d.value,b.offlineMusicPlaylistData){D=b.offlineMusicPlaylistData;break}B=h.playlistId;C=Zz5(h);A=C.XD;Q=C.ID;L=O?(Number(O)*1E3).toString():Date.now().toString();z=h.lastModifiedTimestamp?(Number(h.lastModifiedTimestamp)*1E3).toString():"0";v={id:g.Fv(B,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:Q,lastModifiedTimestampMillis:z,addedTimestampMillis:L,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};t={id:g.Fv(B,"musicAlbumRelease"),title:h.title,audioPlaylistId:B,trackCount:h.totalVideoCount,tracks:A,downloadMetadata:v.id};D&&(t.thumbnailDetails=(R=D.albumHqThumbnail)!=null?R:D.albumArtistThumbnail,t.artistDisplayName=D.albumArtistDisplayName,t.releaseDate=D.albumReleaseDate,t.contentRating={explicitType:D.albumReleaseExplicitType},t.releaseType=D.albumReleaseType);return g.E(p,Fd(N.G,{mode:"readwrite",hd:!0},function(M){var a=Y2(M,t,"musicAlbumRelease");
M=Y2(M,v,"musicAlbumReleaseDownloadMetadataEntity");return g.w_.all([a,M])}),2)}return p.return(t)})},z05=function(N,h){this.G=N;
this.U=h},wYo=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p;
return g.c(function(M){switch(M.G){case 1:return O=Cf(h),u=g.n$(h.entityKey),D=u.entityId,U=[],g.Vy(M,2),g.E(M,vCY(N,D),4);case 4:U=M.W;if((d=U)==null||!d.length){M.l0(5);break}return g.E(M,nLj(N.G,h.entityKey),5);case 5:g.Mt(M,3);break;case 2:return b=g.eo(M),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.CV&&b.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
M.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,B,C));case 3:return A=[],g.E(M,MD4(N.G,"musicTrack",U),7);case 7:U=M.W;if(U.length)for(Q=g.I(U),L=Q.next();!L.done;L=Q.next())if(z=L.value,v=z.offlineVideoData,t=void 0,(t=v)==null?0:t.videoId)R=void 0,p=Number(((R=h.actionMetadata)==null?void 0:R.priority)||0)+1,A.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",v.videoId,"musicTrack",p,kc,eF(h,v,D)));return M.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,A))}})},
KbR=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY,BR,oe,Oa,Ea,nx,or,CS,fx,ae,Gi,sR,XV,bl,e,Ti,ar,uY,Rr,y,hd,PH,nZ,Sx,lY,OR,Dr,WH,V,m,P,q,T,td,x,k,r,Kx,Ir,GZ,iS,xp,PR,OY,V4,Jj,px,Vt;
return g.c(function(cR){switch(cR.G){case 1:return O=Cf(h),u=h.entityKey,D=g.n$(u).entityId,U=[],d=!1,D==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.E(cR,NW(N.G,"musicPlaylist"),5)):g.E(cR,k2(N.G,u,"musicPlaylist"),4);case 4:(b=cR.W)&&U.push(b);cR.l0(3);break;case 5:U=cR.W;case 3:if((B=U)==null||!B.length)return cR.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));C=g.X(h.actionMetadata,kxV);Q=(A=C)==null?void 0:A.autoSync;L=[];v=z=!0;t=!1;R=void 0;if(!d&&Q===!1){cR.l0(6);break}g.Vy(cR,7);return g.E(cR,
bd4(0,!!Q,!0,U),9);case 9:L=cR.W;g.Mt(cR,8);break;case 7:p=g.eo(cR);if(!(p instanceof Error&&p.message==="No data")){p instanceof Error&&p.message==="Empty response body"&&U6(p.message);cR.l0(8);break}return D==="!*$_ALL_ENTITIES_!*$"?g.E(cR,pf(N.G,h,N.U),8):g.E(cR,MW(D,"musicPlaylist",N.G,h,N.U),8);case 8:if(!L.length||!d&&L[0].playlistId!==D)return cR.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));case 6:if(d){M=[];a=g.I(L);for(J=a.next();!J.done;J=a.next())W=J.value,W.upToDate||
Q&&!W.shouldAutoSyncMetadata||!W.playlistId||(F={autoSync:Q},M.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",W.playlistId,"musicPlaylist",0,kc,{musicPlaylistEntityActionMetadata:F})));return cR.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,M))}L.length&&(l=L[0],t=!!l.upToDate,Q&&(z=(iY=l.shouldAutoSyncMetadata)!=null?iY:!0,v=(bY=l.shouldAutoSyncVideos)!=null?bY:!0,l.checkInSeconds&&(R=l.checkInSeconds)));if(t||!z)return cR.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O));BR=[];oe=U[0];Oa=void 0;if(!oe.downloadMetadata){cR.l0(15);break}return g.E(cR,k2(N.G,oe.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Ea=cR.W,Oa=Number((or=(nx=Ea)==null?void 0:nx.addedTimestampMillis)!=null?or:"0")/1E3;case 15:return g.Vy(cR,17),g.E(cR,vCY(N,D,(CS=Oa)==null?void 0:CS.toString(),R),19);case 19:BR=cR.W;g.Mt(cR,18);break;case 17:fx=g.eo(cR);if(!(fx instanceof Error&&fx.message==="No data")){if(fx instanceof Error&&fx.message==="Empty response body")U6(fx.message);
else return ae="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Gi="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",fx instanceof g.CV&&fx.type==="QUOTA_EXCEEDED"&&(ae="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Gi="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),cR.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,ae,Gi));cR.l0(18);break}return g.E(cR,MW(D,"musicPlaylist",N.G,h,N.U),18);case 18:if(!v)return cR.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O));sR=[];XV=new Map;if((bl=BR)==null?0:bl.length)for(e=g.I(BR),Ti=e.next();!Ti.done;Ti=e.next())ar=Ti.value,uY=ar.offlineVideoData,Rr=void 0,((Rr=uY)==null?0:Rr.videoId)&&XV.set(uY.videoId,uY);y=new Map;hd=[];if((PH=oe)==null?0:(nZ=PH.tracks)==null?0:nZ.length)for(Sx=g.I(oe.tracks),lY=Sx.next();!lY.done;lY=Sx.next())if(OR=lY.value,Dr=g.n$(OR).entityId)XV.has(Dr)?(y.set(Dr,XV.get(Dr)),XV.delete(Dr)):hd.push(Dr);V=Number(((WH=h.actionMetadata)==null?void 0:WH.priority)||0)+1;m=g.I(XV.entries());for(P=
m.next();!P.done;P=m.next())q=P.value,T=g.I(q),td=T.next().value,x=T.next().value,k=td,r=x,sR.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"musicTrack",V,kc,eF(h,r)));Kx=g.I(y.entries());for(Ir=Kx.next();!Ir.done;Ir=Kx.next())GZ=Ir.value,iS=g.I(GZ),xp=iS.next().value,PR=iS.next().value,OY=xp,V4=PR,sR.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",OY,"musicTrack",V,kc,eF(h,V4)));Jj=g.I(hd);for(px=Jj.next();!px.done;px=Jj.next())Vt=px.value,sR.push(qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Vt,"musicTrack",0,kc));return cR.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,sR))}})},mqY=function(N,h){var O,u;
return g.c(function(D){switch(D.G){case 1:return O=Cf(h),g.Vy(D,2),u=g.n$(h.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.E(D,pf(N.G,h,N.U),5):g.E(D,MW(u,"musicPlaylist",N.G,h,N.U),6);case 6:return g.E(D,FD5(N.G,h.entityKey),5);case 5:g.Mt(D,3);break;case 2:return g.eo(D),D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},vCY=function(N,h,O,u){var D,U,d;
return g.c(function(b){switch(b.G){case 1:return g.E(b,OdK([h]),2);case 2:return D=b.W,g.E(b,Iur(N,D[0],O,u),3);case 3:return U=b.W,d=wL(U.thumbnailDetails),g.E(b,$c(d),4);case 4:return b.return(D[0].videos)}})},Iur=function(N,h,O,u){var D,U,d,b,B,C,A,Q,L;
return g.c(function(z){return z.G==1?(D=h.playlistId,U=Zz5(h),d=U.XD,b=U.ID,B=O?(Number(O)*1E3).toString():Date.now().toString(),C=h.lastModifiedTimestamp?(Number(h.lastModifiedTimestamp)*1E3).toString():"0",A={id:g.Fv(D,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:b,lastModifiedTimestampMillis:C,addedTimestampMillis:B,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},Q={id:g.Fv(D,"musicPlaylist"),title:h.title,playlistId:D,thumbnailDetails:h.thumbnail,visibility:tsm(h),trackCount:h.totalVideoCount,
tracks:d,downloadMetadata:A.id},u&&(((L=Q)==null?0:L.entityMetadata)?Q.entityMetadata.nextAutoRefreshIntervalSeconds=String(u):Q&&(Q.entityMetadata={nextAutoRefreshIntervalSeconds:String(u)})),g.E(z,Fd(N.G,{mode:"readwrite",hd:!0},function(v){var t=Y2(v,Q,"musicPlaylist");v=Y2(v,A,"musicPlaylistDownloadMetadataEntity");return g.w_.all([t,v])}),2)):z.return(Q)})},tsm=function(N){switch(N.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},$qx=function(N,h){this.G=N;
this.U=h},PFV=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v;
return g.c(function(t){switch(t.G){case 1:return O=Cf(h),u=g.n$(h.entityKey),D=u.entityId,U=g.X(h.actionMetadata,yYK),g.Vy(t,2),g.E(t,Vsr(N,D,void 0,(d=U)==null?void 0:d.track,(b=U)==null?void 0:b.albumRelease),4);case 4:if((B=U)==null?0:B.playlistId){t.l0(5);break}return g.E(t,nLj(N.G,h.entityKey),5);case 5:g.Mt(t,3);break;case 2:return C=g.eo(t),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.CV&&C.type==="QUOTA_EXCEEDED"&&
(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),t.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,A,Q));case 3:z=Number(((L=h.actionMetadata)==null?void 0:L.priority)||0)+1;var R=(R=g.X(h.actionMetadata,yYK))?{playbackDataActionMetadata:{maximumDownloadQuality:R.maximumDownloadQuality}}:void 0;v=qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",D,"playbackData",z,R05,R);return t.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O,[v]))}})},Msr=function(N,h){var O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R;
return g.c(function(p){switch(p.G){case 1:return O=Cf(h),u=g.n$(h.entityKey),D=u.entityId,g.E(p,k2(N.G,h.entityKey,"musicTrack"),2);case 2:U=p.W;if(!U){d=void 0;p.l0(3);break}return g.E(p,k2(N.G,U.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:d=p.W;case 3:b=d;if(!U||!b)return p.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));C=g.X(h.actionMetadata,yYK);g.Vy(p,5);return g.E(p,Vsr(N,D,b.addedTimestampMillis,(A=C)==null?void 0:A.track,(Q=C)==null?void 0:Q.albumRelease),
7);case 7:z=Number(((L=h.actionMetadata)==null?void 0:L.priority)||0)+1;B=qW("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D,"playbackData",z,R05);g.Mt(p,6);break;case 5:v=g.eo(p);if(!(v instanceof Error&&v.message==="No data")){if(v instanceof Error&&v.message==="Empty response body")U6(v.message);else return t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",R="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.CV&&v.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
R="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),p.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,t,R));p.l0(6);break}return g.E(p,Pf(D,N.G,h,N.U),6);case 6:return p.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,B?[B]:void 0))}})},pYo=function(N,h){var O,u;
return g.c(function(D){switch(D.G){case 1:return O=Cf(h),g.Vy(D,2),u=g.n$(h.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.E(D,pf(N.G,h,N.U),5):g.E(D,Pf(u,N.G,h,N.U),6);case 6:return g.E(D,FD5(N.G,h.entityKey),5);case 5:g.Mt(D,3);break;case 2:return g.eo(D),D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new gL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},Vsr=function(N,h,O,u,D){var U,d,b,B,C,A;
return g.c(function(Q){switch(Q.G){case 1:if(U=u){Q.l0(2);break}return g.E(Q,hGR([h]),3);case 3:d=Q.W,b=d[0],U=xmY(b);case 2:return g.E(Q,e0r(N,U,h,D,O),4);case 4:B=Q.W;C=B.musicTrackEntity;A=B.SJ;var L=wL(C.thumbnailDetails),z=[];A&&(z=wL(A.thumbnailDetails));return g.E(Q,$c(L.concat(z)),0)}})},e0r=function(N,h,O,u,D){var U;
return g.c(function(d){return d.G==1?(D||(D=Date.now().toString()),U={id:g.Fv(O,"musicTrackDownloadMetadataEntity"),playbackData:g.Fv(O,"playbackData"),addedTimestampMillis:D,videoDownloadContextEntity:g.Fv(O,"videoDownloadContextEntity")},u&&(h.albumRelease=u.id),g.E(d,Fd(N.G,{mode:"readwrite",hd:!0},function(b){var B=[],C=Y2(b,U,"musicTrackDownloadMetadataEntity");B.push(C);C=Y2(b,h,"musicTrack");B.push(C);u&&(b=Y2(b,u,"musicAlbumRelease"),B.push(b));return g.w_.all(B)}),2)):d.G!=3?g.E(d,Lf(O,"musicTrackDownloadMetadataEntity",
N.G,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):d.return({musicTrackEntity:h,
SJ:u})})},N6=function(){lJ.apply(this,arguments);
this.D="musicTrack"},ECS=function(N,h,O){h=h===void 0?43200:h;
O=O===void 0?!0:O;var u=u===void 0?!1:u;var D,U;return g.c(function(d){switch(d.G){case 1:if(!N.V.rA())return d.return([]);D=[];g.Vy(d,2);return g.E(d,bd4(h,O,u),4);case 4:D=d.W;g.Mt(d,3);break;case 2:g.eo(d);case 3:return U=sOm(N,D,O,"musicPlaylist"),d.return(U)}})},cY5=function(){g.Vq.apply(this,arguments);
var N=this;this.events=new g.yg(this);this.Qm=this.player.K();this.KF={Qe5:function(){return N.G},
HR:function(){return N.HR()},
a4:function(h){return N.a4(h)}}},aux=function(N){var h;
N=g.X((h=N.getWatchNextResponse())==null?void 0:h.currentVideoEndpoint,g.Vi);if(N==null?0:N.playlistId)var O=N.playlistId;return O},qUS=function(N,h){var O,u,D,U;
return g.c(function(d){if(d.G==1){O=h.clientPlaybackNonce;u={cpn:O,offlineSourceVisualElement:g.vN(h.m$||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};h.W&&(u.videoFmt=Number(h.W.itag));h.X&&(u.audioFmt=Number(h.X.itag));if((D=aux(h))&&h.videoId){var b=h.videoId;b=D!=="PPSV"?Promise.resolve(!1):N.G.Lv(b);d=g.E(d,b,3)}else d=d.l0(2);return d}d.G!=2&&(U=d.W)&&(u.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");N.W=O;g.DR("offlinePlaybackStarted",u);g.yy(d)})};
g.lw.prototype.Yg=g.Dd(45,function(N){return this.app.Yg(N)});
g.wG.prototype.Yg=g.Dd(44,function(N){return g.j2R(this,9,N)});
g.K(JH,sr);g.Ua.Object.defineProperties(JH.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.G.entityMetadata},
set:function(N){this.G.entityMetadata=N}}});
g.K(tKm,JH);tKm.prototype.W=function(){return[]};
g.K($fj,JH);$fj.prototype.W=function(){return[]};
g.K(yXm,JH);yXm.prototype.W=function(){return[]};
g.K(VKn,JH);VKn.prototype.W=function(){return[]};
g.K(Rix,JH);Rix.prototype.W=function(){return[]};
g.K(PBY,JH);PBY.prototype.W=function(){var N=[];this.G.alternateChannel&&N.push(this.G.alternateChannel);this.G.alternateChannelList&&N.push.apply(N,g.Lx(this.G.alternateChannelList));this.G.oneofChannelEntity&&N.push(this.G.oneofChannelEntity);return[].concat(g.Lx(new Set(N)))};
g.K(MK4,JH);MK4.prototype.W=function(){var N=[];this.G.entryCollection&&N.push(this.G.entryCollection);return[].concat(g.Lx(new Set(N)))};
g.K(p7Y,sr);p7Y.prototype.W=function(){var N=[];this.G.video&&N.push(this.G.video);return[].concat(g.Lx(new Set(N)))};
g.K(eiS,JH);eiS.prototype.W=function(){var N=[];this.G.parentPlaylist&&N.push(this.G.parentPlaylist);if(this.G.entries)for(var h=g.I(this.G.entries),O=h.next();!O.done;O=h.next())N.push.apply(N,g.Lx((new p7Y(O.value)).W()));return[].concat(g.Lx(new Set(N)))};
g.K(Exj,JH);Exj.prototype.W=function(){var N=[];this.G.descriptionEntity&&N.push(this.G.descriptionEntity);this.G.creators&&N.push.apply(N,g.Lx(this.G.creators));this.G.theBiggestFan&&N.push(this.G.theBiggestFan);return[].concat(g.Lx(new Set(N)))};
g.K(cXr,JH);cXr.prototype.W=function(){return[]};
g.K(agY,JH);agY.prototype.W=function(){return[]};
g.K(qt5,JH);qt5.prototype.W=function(){return[]};
g.K(gxS,JH);gxS.prototype.W=function(){return[]};
g.K(rXr,JH);rXr.prototype.W=function(){return[]};
g.K(szY,JH);szY.prototype.W=function(){return[]};
g.K(JXY,JH);JXY.prototype.W=function(){return[]};
g.K(jzo,JH);jzo.prototype.W=function(){return[]};
g.K(Stm,JH);Stm.prototype.W=function(){return[]};
g.K(HUj,JH);HUj.prototype.W=function(){var N=[];this.G.downloadsList&&N.push(this.G.downloadsList);this.G.smartDownloadsList&&N.push(this.G.smartDownloadsList);this.G.recommendedDownloadsList&&N.push(this.G.recommendedDownloadsList);this.G.refresh&&N.push(this.G.refresh);return[].concat(g.Lx(new Set(N)))};
g.K(Tp5,sr);Tp5.prototype.W=function(){var N=[];this.G.video&&N.push(this.G.video);this.G.playlist&&N.push(this.G.playlist);this.G.videoItem&&N.push(this.G.videoItem);this.G.playlistItem&&N.push(this.G.playlistItem);return[].concat(g.Lx(new Set(N)))};
g.K(W_r,JH);W_r.prototype.W=function(){var N=[];this.G.refresh&&N.push(this.G.refresh);if(this.G.downloads)for(var h=g.I(this.G.downloads),O=h.next();!O.done;O=h.next())N.push.apply(N,g.Lx((new Tp5(O.value)).W()));return[].concat(g.Lx(new Set(N)))};
g.K(X7Y,JH);X7Y.prototype.W=function(){var N=[];this.G.localImageEntities&&N.push.apply(N,g.Lx(this.G.localImageEntities));return[].concat(g.Lx(new Set(N)))};
g.K(fgo,JH);fgo.prototype.W=function(){var N=[];this.G.playbackData&&N.push(this.G.playbackData);this.G.localImageEntities&&N.push.apply(N,g.Lx(this.G.localImageEntities));this.G.videoDownloadContextEntity&&N.push(this.G.videoDownloadContextEntity);return[].concat(g.Lx(new Set(N)))};
g.K(Ytn,JH);Ytn.prototype.W=function(){return[]};
g.K(lg5,JH);lg5.prototype.W=function(){var N=[];this.G.fakeChildren&&N.push.apply(N,g.Lx(this.G.fakeChildren));return[].concat(g.Lx(new Set(N)))};
g.K(xfY,JH);xfY.prototype.W=function(){var N=[];this.G.video&&N.push(this.G.video);this.G.playbackData&&N.push(this.G.playbackData);this.G.offlineVideoPolicy&&N.push(this.G.offlineVideoPolicy);return[].concat(g.Lx(new Set(N)))};
g.K(nx5,JH);nx5.prototype.W=function(){return[]};
g.K(F_x,JH);F_x.prototype.W=function(){var N=[];this.G.channelOwner&&N.push(this.G.channelOwner);this.G.videos&&N.push.apply(N,g.Lx(this.G.videos));this.G.collaboratorChannels&&N.push.apply(N,g.Lx(this.G.collaboratorChannels));this.G.downloadState&&N.push(this.G.downloadState);this.G.refresh&&N.push(this.G.refresh);return[].concat(g.Lx(new Set(N)))};
g.K(ZUn,JH);ZUn.prototype.W=function(){var N=[];this.G.video&&N.push(this.G.video);this.G.channelContributor&&N.push(this.G.channelContributor);return[].concat(g.Lx(new Set(N)))};
g.K(kvm,sr);kvm.prototype.W=function(){var N=[];this.G.localImageEntities&&N.push.apply(N,g.Lx(this.G.localImageEntities));this.G.videoDownloadContextEntity&&N.push(this.G.videoDownloadContextEntity);return[].concat(g.Lx(new Set(N)))};
g.K(NmS,sr);NmS.prototype.W=function(){var N=[];this.G.recommendedVideoMetadata&&N.push.apply(N,g.Lx((new kvm(this.G.recommendedVideoMetadata)).W()));return[].concat(g.Lx(new Set(N)))};
g.K(hfr,sr);hfr.prototype.W=function(){var N=[];this.G.playbackPosition&&N.push(this.G.playbackPosition);return[].concat(g.Lx(new Set(N)))};
g.K(O2S,JH);O2S.prototype.W=function(){var N=[];this.G.owner&&N.push(this.G.owner);this.G.downloadState&&N.push(this.G.downloadState);this.G.userState&&N.push.apply(N,g.Lx((new hfr(this.G.userState)).W()));this.G.additionalMetadata&&N.push.apply(N,g.Lx((new NmS(this.G.additionalMetadata)).W()));return[].concat(g.Lx(new Set(N)))};
g.K(u9x,JH);u9x.prototype.W=function(){var N=[];this.G.userChannelDetails&&N.push(this.G.userChannelDetails);return[].concat(g.Lx(new Set(N)))};
g.K(D9R,JH);D9R.prototype.W=function(){var N=[];this.G.channelOwner&&N.push(this.G.channelOwner);this.G.playbackPosition&&N.push(this.G.playbackPosition);this.G.localImageEntities&&N.push.apply(N,g.Lx(this.G.localImageEntities));this.G.downloadStatus&&N.push(this.G.downloadStatus);return[].concat(g.Lx(new Set(N)))};
g.K(U9Y,JH);U9Y.prototype.W=function(){return[]};
g.K(d9S,JH);d9S.prototype.W=function(){return[]};
g.K(Gsx,JH);Gsx.prototype.W=function(){return[]};
g.K(b2j,JH);b2j.prototype.W=function(){return[]};
g.K(i2V,JH);i2V.prototype.W=function(){return[]};
g.K(Bm4,JH);Bm4.prototype.W=function(){return[]};
g.K(CHV,JH);CHV.prototype.W=function(){return[]};
g.K(Asx,JH);Asx.prototype.W=function(){return[]};
g.K(oGR,JH);oGR.prototype.W=function(){return[]};
g.K(Q0Y,JH);Q0Y.prototype.W=function(){return[]};
g.K(Lmm,JH);Lmm.prototype.W=function(){return[]};
g.K(zfj,JH);zfj.prototype.W=function(){return[]};
g.K(vGx,JH);vGx.prototype.W=function(){var N=[];this.G.trackDownloadMetadatas&&N.push.apply(N,g.Lx(this.G.trackDownloadMetadatas));return[].concat(g.Lx(new Set(N)))};
g.K(wOo,JH);
wOo.prototype.W=function(){var N=[];this.G.downloadedTracks&&N.push.apply(N,g.Lx(this.G.downloadedTracks));this.G.smartDownloadedTracks&&N.push.apply(N,g.Lx(this.G.smartDownloadedTracks));this.G.downloadedEpisodes&&N.push.apply(N,g.Lx(this.G.downloadedEpisodes));this.G.downloadedAlbumReleases&&N.push.apply(N,g.Lx(this.G.downloadedAlbumReleases));this.G.smartDownloadedAlbumReleases&&N.push.apply(N,g.Lx(this.G.smartDownloadedAlbumReleases));this.G.downloadedPlaylists&&N.push.apply(N,g.Lx(this.G.downloadedPlaylists));this.G.smartDownloadedPlaylists&&
N.push.apply(N,g.Lx(this.G.smartDownloadedPlaylists));this.G.metadataOnlyTracks&&N.push.apply(N,g.Lx(this.G.metadataOnlyTracks));return[].concat(g.Lx(new Set(N)))};
g.K(KmK,JH);KmK.prototype.W=function(){var N=[];this.G.trackDownloadMetadatas&&N.push.apply(N,g.Lx(this.G.trackDownloadMetadatas));return[].concat(g.Lx(new Set(N)))};
g.K(m9S,JH);m9S.prototype.W=function(){var N=[];this.G.playbackData&&N.push(this.G.playbackData);this.G.localImageEntities&&N.push.apply(N,g.Lx(this.G.localImageEntities));this.G.videoDownloadContextEntity&&N.push(this.G.videoDownloadContextEntity);return[].concat(g.Lx(new Set(N)))};
g.K(ITS,JH);ITS.prototype.W=function(){var N=[];this.G.musicLibraryStatusEntity&&N.push(this.G.musicLibraryStatusEntity);this.G.primaryArtists&&N.push.apply(N,g.Lx(this.G.primaryArtists));this.G.details&&N.push(this.G.details);this.G.userDetails&&N.push(this.G.userDetails);this.G.tracks&&N.push.apply(N,g.Lx(this.G.tracks));this.G.share&&N.push(this.G.share);this.G.downloadMetadata&&N.push(this.G.downloadMetadata);this.G.refresh&&N.push(this.G.refresh);return[].concat(g.Lx(new Set(N)))};
g.K(tbo,JH);tbo.prototype.W=function(){var N=[];this.G.albumRelease&&N.push(this.G.albumRelease);this.G.tracks&&N.push.apply(N,g.Lx(this.G.tracks));return[].concat(g.Lx(new Set(N)))};
g.K($94,JH);$94.prototype.W=function(){var N=[];this.G.albumRelease&&N.push(this.G.albumRelease);return[].concat(g.Lx(new Set(N)))};
g.K(ysS,JH);ysS.prototype.W=function(){var N=[];this.G.details&&N.push(this.G.details);this.G.userDetails&&N.push(this.G.userDetails);return[].concat(g.Lx(new Set(N)))};
g.K(VbV,JH);VbV.prototype.W=function(){var N=[];this.G.parentArtist&&N.push(this.G.parentArtist);return[].concat(g.Lx(new Set(N)))};
g.K(Rfr,JH);Rfr.prototype.W=function(){var N=[];this.G.parentArtist&&N.push(this.G.parentArtist);return[].concat(g.Lx(new Set(N)))};
g.K(PH4,JH);PH4.prototype.W=function(){return[]};
g.K(Mbx,JH);Mbx.prototype.W=function(){return[]};
g.K(pO5,sr);pO5.prototype.W=function(){var N=[];this.G.creatorEntity&&N.push(this.G.creatorEntity);return[].concat(g.Lx(new Set(N)))};
g.K(efj,JH);
efj.prototype.W=function(){var N=[];this.G.tracks&&N.push.apply(N,g.Lx(this.G.tracks));this.G.refresh&&N.push(this.G.refresh);this.G.musicLibraryStatusEntity&&N.push(this.G.musicLibraryStatusEntity);this.G.details&&N.push(this.G.details);this.G.downloadMetadata&&N.push(this.G.downloadMetadata);this.G.sideloadMetadata&&N.push(this.G.sideloadMetadata);this.G.userDetails&&N.push(this.G.userDetails);this.G.entryCollection&&N.push(this.G.entryCollection);this.G.share&&N.push(this.G.share);this.G.podcastShowAdditionalMetadata&&
N.push.apply(N,g.Lx((new pO5(this.G.podcastShowAdditionalMetadata)).W()));return[].concat(g.Lx(new Set(N)))};
g.K(EGr,JH);EGr.prototype.W=function(){return[]};
g.K(csn,JH);
csn.prototype.W=function(){var N=[];this.G.musicLibraryStatusEntity&&N.push(this.G.musicLibraryStatusEntity);this.G.artists&&N.push.apply(N,g.Lx(this.G.artists));this.G.audioModeVersion&&N.push(this.G.audioModeVersion);this.G.videoModeVersion&&N.push(this.G.videoModeVersion);this.G.userDetails&&N.push(this.G.userDetails);this.G.details&&N.push(this.G.details);this.G.albumRelease&&N.push(this.G.albumRelease);this.G.share&&N.push(this.G.share);this.G.libraryEdit&&N.push(this.G.libraryEdit);this.G.downloadMetadata&&
N.push(this.G.downloadMetadata);this.G.playbackPosition&&N.push(this.G.playbackPosition);this.G.lyrics&&N.push(this.G.lyrics);return[].concat(g.Lx(new Set(N)))};
g.K(aTY,JH);aTY.prototype.W=function(){var N=[];this.G.parentTrack&&N.push(this.G.parentTrack);return[].concat(g.Lx(new Set(N)))};
g.K(q2r,JH);q2r.prototype.W=function(){var N=[];this.G.parentTrack&&N.push(this.G.parentTrack);return[].concat(g.Lx(new Set(N)))};
g.K(gGn,JH);gGn.prototype.W=function(){return[]};
g.K(rsR,JH);rsR.prototype.W=function(){return[]};
g.K(s0n,JH);s0n.prototype.W=function(){return[]};
g.K(Js4,JH);Js4.prototype.W=function(){return[]};
g.K(j0S,JH);j0S.prototype.W=function(){var N=[];this.G.transfer&&N.push(this.G.transfer);this.G.adsPlaybackData&&N.push.apply(N,g.Lx(this.G.adsPlaybackData));this.G.drmLicense&&N.push(this.G.drmLicense);this.G.offlineVideoPolicy&&N.push(this.G.offlineVideoPolicy);this.G.videoDownloadContextEntity&&N.push(this.G.videoDownloadContextEntity);return[].concat(g.Lx(new Set(N)))};
g.K(S25,JH);S25.prototype.W=function(){return[]};
g.K(H2n,JH);H2n.prototype.W=function(){var N=[];this.G.offlineVideoStreams&&N.push.apply(N,g.Lx(this.G.offlineVideoStreams));this.G.captionTrack&&N.push.apply(N,g.Lx(this.G.captionTrack));return[].concat(g.Lx(new Set(N)))};
g.K(Tmn,JH);Tmn.prototype.W=function(){return[]};
g.K(WmY,JH);WmY.prototype.W=function(){return[]};
g.K(XO5,JH);XO5.prototype.W=function(){return[]};
g.K(fTS,JH);fTS.prototype.W=function(){return[]};
g.K(Y2Y,JH);Y2Y.prototype.W=function(){return[]};
g.K(lT4,JH);lT4.prototype.W=function(){return[]};
g.K(x94,JH);x94.prototype.W=function(){return[]};
g.K(nGY,JH);nGY.prototype.W=function(){return[]};
g.K(FmY,JH);FmY.prototype.W=function(){return[]};
g.K(Z2R,JH);Z2R.prototype.W=function(){return[]};
g.K(ks5,JH);ks5.prototype.W=function(){return[]};
g.K(NiY,JH);NiY.prototype.W=function(){return[]};
g.K(hBY,JH);hBY.prototype.W=function(){return[]};
g.K(OmY,JH);OmY.prototype.W=function(){return[]};
g.K(uIV,JH);uIV.prototype.W=function(){return[]};
g.K(DZr,JH);DZr.prototype.W=function(){return[]};
g.K(UZr,JH);UZr.prototype.W=function(){return[]};
g.K(dZK,JH);dZK.prototype.W=function(){return[]};
g.K(GjK,JH);GjK.prototype.W=function(){return[]};
g.K(bmV,JH);bmV.prototype.W=function(){return[]};
g.K(imn,JH);imn.prototype.W=function(){return[]};
g.K(Bin,JH);Bin.prototype.W=function(){return[]};
var idS=["browse","music/browse","unplugged/browse"],QJR=["offline/playlist_sync_check"],NI4=["offline"],BI4=["offline/offline_video_playback_position_sync"],Ah4=["offline/get_playback_data_entity"],ju;Su.getInstance=function(){return g.c(function(N){return N.return(new Promise(function(h){g.xT().then(function(O){O?(Su.instance||(Su.instance=new Su(O)),h(Su.instance)):h(void 0)})}))})};
Su.prototype.get=function(N){var h=this,O,u,D;return g.c(function(U){if(U.G==1)return g.E(U,QGo(h.token),2);if(U.G!=3)return O=U.W,g.E(U,O.get("prefs",N),3);u=U.W;if(!u)return U.return();D=(0,g.to)();return u.expirationTimestampMs<=D?U.return():U.return(u.value)})};
Su.prototype.set=function(N,h,O){O=O===void 0?31536E3:O;var u=this,D,U,d;return g.c(function(b){if(b.G==1)return D=(0,g.to)(),U={key:N,value:h,expirationTimestampMs:D+O*1E3},g.E(b,QGo(u.token),2);d=b.W;return g.E(b,g.pV(d,"prefs",U),0)})};
Su.prototype.remove=function(N){var h=this,O;return g.c(function(u){if(u.G==1)return g.E(u,QGo(h.token),2);O=u.W;return g.E(u,O.delete("prefs",N),0)})};
g.K(Hu,g.H5);g.K(TO,KnS);TO.prototype.U=function(N,h){h=IJx(h);N=(new TextEncoder).encode(JSON.stringify(N));return this.G.encrypt(N,h)};
TO.prototype.W=function(N,h){if(!(N instanceof Uint8Array))throw Ln5(1);var O=new TextDecoder;h=IJx(h);N=this.G.decrypt(N,h);return JSON.parse(O.decode(N))};
var tWR={accountLinkStatusEntity:qt5,booleanEntity:VKn,buttonEntity:uIV,captionTrack:gGn,channelHandle:tKm,chipEntity:x94,commerceAcquisitionClientPayloadEntity:UZr,commerceCartListEntity:dZK,contextNoteFeedEntityPayload:$fj,contextNoteUserRatingEntityPayload:yXm,continuationTokenEntity:nx5,downloadQualityPickerEntity:JXY,downloadsPageRefreshTokenEntity:Stm,downloadsPageViewConfigurationEntity:U9Y,downloadStatusEntity:jzo,dismissState:nGY,sfvAudioItemCurrentlyPlayingEntity:fTS,emojiFountainDataEntity:hBY,
emojiCustomizationSetEntity:NiY,fakeChannel:PBY,fakePlaylist:MK4,fakePlaylistEntryCollection:eiS,fakeVideo:Exj,fakeVideoDescription:cXr,featuredProductsEntity:Q0Y,flowStateEntity:agY,iconBadgeEntity:GjK,interstitialInteractionStateEntity:rXr,likeButtonAnimationEntity:d9S,liveChatPollStateEntity:szY,dataFreshnessEntity:ks5,liveViewerLeaderboardChatEntryPointStateEntity:WmY,liveViewerLeaderboardPointsEntity:XO5,liveReactionsDataEntity:OmY,logoEntity:gxS,macroMarkerEntity:Gsx,mainDownloadsLibraryEntity:HUj,
mainDownloadsListEntity:W_r,mainPlaylistDownloadStateEntity:X7Y,mainPlaylistEntity:F_x,mainPlaylistVideoEntity:ZUn,mainVideoDownloadStateEntity:fgo,mainVideoEntity:O2S,markersEngagementPanelSyncEntity:b2j,markersVisibilityOverrideEntity:i2V,musicAlbumReleaseDetail:tbo,musicAlbumReleaseDownloadMetadataEntity:vGx,musicAlbumRelease:ITS,musicAlbumReleaseUserDetail:$94,musicArtistDetail:VbV,musicArtist:ysS,musicArtistUserDetail:Rfr,musicDownloadsLibraryEntity:wOo,musicLibraryEdit:PH4,musicLibraryStatusEntity:Mbx,
musicPlaylist:efj,musicPlaylistDownloadMetadataEntity:KmK,musicShare:EGr,musicTrackDetail:aTY,musicTrackDownloadMetadataEntity:m9S,musicTrack:csn,musicTrackUserDetail:q2r,offlineOrchestrationActionWrapperEntity:rsR,offlineVideoPolicy:s0n,offlineVideoStreams:Js4,offlineabilityEntity:Ytn,orchestrationWebSamplingEntity:lg5,pageHeaderEntity:FmY,pdpStateEntity:bmV,pinnedProductEntity:Lmm,playbackData:j0S,playerStateEntity:Bm4,quantityIncrementerEntity:imn,refresh:S25,saveToPlaylistListEntity:Y2Y,selectedChipIndexEntityPayload:CHV,
settingEntity:lT4,stringEntity:Rix,suggestedFeedbackChipStateEntity:Asx,transfer:H2n,trendingOfferEntity:zfj,videoDownloadContextEntity:Tmn,videoOverviewAsyncDataEntity:Bin,videoPlaybackPositionEntity:DZr,votingEntity:Z2R,ytMainChannelEntity:u9x,youchatPendingResponseEntity:oGR,ytMainDownloadedVideoEntity:xfY,ytMainVideoEntity:D9R};g.K(x2,KnS);x2.prototype.U=function(N){return N};
x2.prototype.W=function(N){if(N instanceof Uint8Array)throw Ln5(0);return N};
g.K(ni,g.S);ni.prototype.observe=function(N){var h=this;this.observers.push(N);return function(){var O=h.observers.indexOf(N);O>=0&&h.observers.splice(O,1)}};
ni.prototype.W=function(N){rzR(this,N.data)};
ni.prototype.q5=function(){this.channel.close()};
var HmY,j9r=new g.te("elementsCommand");var Vw=new g.te("entityBatchUpdate");var PaS=new g.te("downloadStatusEntity");var WpS=new g.te("mainPlaylistEntityActionMetadata");var Fm=new g.te("mainVideoEntityActionMetadata");var kxV=new g.te("musicPlaylistEntityActionMetadata");var yYK=new g.te("musicTrackEntityActionMetadata");var Uqj=new g.te("localImageEntityActionMetadata");var rL=new g.te("playbackDataActionMetadata");var SCx=new g.te("transferEntityActionMetadata");var Vpr=new g.te("videoPlaybackPositionEntityActionMetadata");var ui4;new g.oG;new g.oG;bzS.prototype.request=function(N,h,O){h=h===void 0?{}:h;return this.locks.request(N,h,function(u){return O(u)})};var Dk=g.kp.caches,uJ,oLr;O6.prototype.open=function(N){return Dk.open(Cax(N))};
O6.prototype.has=function(N){return Dk.has(Cax(N))};
O6.prototype.delete=function(N){return Dk.delete(Cax(N))};
O6.prototype.match=function(N,h){var O=this,u,D,U,d,b,B;return g.c(function(C){switch(C.G){case 1:return g.E(C,O.keys(),2);case 2:u=C.W,D=g.I(u),U=D.next();case 3:if(U.done){C.l0(5);break}d=U.value;return g.E(C,O.open(d),6);case 6:return b=C.W,g.E(C,b.match(N,h),7);case 7:if(B=C.W)return C.return(B);U=D.next();C.l0(3);break;case 5:return C.return()}})};
g.K(BOn,O6);BOn.prototype.keys=function(){var N,h,O,u,D,U,d,b,B;return g.c(function(C){if(C.G==1)return N=[],h=g.T4("CacheStorage keys"),g.E(C,Dk.keys(),2);O=C.W;u=g.I(O);for(D=u.next();!D.done;D=u.next()){U=D.value;var A=U.indexOf(":");d=A===-1?{H_:U}:{H_:U.substring(0,A),datasyncId:U.substring(A+1)};b=d.H_;B=d.datasyncId;B===h&&N.push(b)}return C.return(N)})};g.K(dL,g.S);dL.prototype.U=function(N){this.api.wf("onOfflineOperationFailure",N.data)};
dL.prototype.X=function(N){this.api.publish("offlinetransferpause",N.data)};
dL.prototype.q5=function(){var N;(N=this.G)==null||N.close();var h;(h=this.W)==null||h.close()};zvY.prototype.Aw=function(){this.G&&bJ(this)};
zvY.prototype.Ws=function(){this.W&&this.W.resolve();this.U=this.G=!1;this.D()};var u45=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var r0Y="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var lx4="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.K(zGo,aM);zGo.prototype.W=function(N){return Ay(N)?KKS(this,N):oM(N)?tp5(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};g.K($xV,aM);$xV.prototype.W=function(N){return oM(N)?yhj(this,N):Rvo(N)?RGx(this,N):Qw(N)?P9x(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};g.w=Mpr.prototype;g.w.OFr=function(N){var h=this,O,u,D,U;return g.c(function(d){if(!g.Y(N.state,128))return d.l0(0);O=N.state.RN;var b=(u=O)==null?void 0:u.errorCode,B=(D=O)==null?void 0:D.aM;U=b==="net.connect"&&B===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(b==null?0:b.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.E(d,h.x5(h.player.getVideoData().videoId,U),0)})};
g.w.x5=function(N,h){var O=this;return g.c(function(u){if(u.G==1){if(O.W)return u.return();O.W=!0;return h==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(jF(O,N,!1,!0),u.l0(0)):g.E(u,Jy(O,N),3)}g.dZ(N,4);return g.E(u,O.G.x5(h),0)})};
g.w.rD=function(N){N.status===2?(N.status!==this.U&&(yej(this.G),g.dZ(N.videoId,2)),N.NP&&pC5(this.G,N.videoId,N.NP)):N.status===4?(Jy(this,N.videoId),this.x5(N.videoId,N.GH?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):N.status===1&&MPR(this.G);this.U=N.status;this.api.wf("localmediachange",{videoId:N.videoId,status:N.status})};
g.w.KY=function(){var N=this,h;return g.c(function(O){if(O.G==1){if(N.W)return O.return();N.W=!0;h=N.player.getVideoData().videoId;return g.E(O,Jy(N,h),2)}return g.E(O,N.G.KY(),0)})};
g.w.Sa=function(N){switch(N){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.w.j=function(N){return this.api.K().j(N)};g.K(giS,aM);giS.prototype.W=function(N){return Ay(N)?sJV(this,N):oM(N)?Jhn(this,N):Rvo(N)?jJo(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};fGY.prototype.G=function(N,h){var O=N.action.actionMetadata.priority-h.action.actionMetadata.priority;O===0&&(N.G<h.G?O=-1:N.G>h.G&&(O=1));return O};g.K(SF,g.S);SF.prototype.q5=function(){this.D&&this.D();g.S.prototype.q5.call(this)};
SF.prototype.createAction=function(N,h){var O=g.n$(N.entityKey).entityType,u=g.vJ(16);return new Kf(O,u,N,h.actionId,h.rootActionId)};
SF.prototype.fC=function(N){var h=this,O,u,D,U,d,b,B,C,A;return g.c(function(Q){if(Q.G==1){if(h.SS())return Q.return();u=(O=N.offlineOrchestrationActionWrapperEntity)!=null?O:new Set;D=[];U=g.I(u);for(d=U.next();!d.done;d=U.next())b=d.value,B=g.n$(b),C=B.entityId,xx4(h.G,C)||D.push(b);return g.E(Q,d34(h,D),2)}A=Q.W;return g.E(Q,U3S(h,A),0)})};
SF.prototype.retry=function(){var N=this;return g.c(function(h){return g.E(h,Gbj(N),0)})};i7r.prototype.AF=function(N,h){h=h===void 0?!0:h;var O=this,u,D,U,d,b,B,C,A;return g.c(function(Q){switch(Q.G){case 1:if(!O.G)return Q.return();u=[];D=g.Ue(O.G.W,h);U=[];for(d={ly:0};d.ly<D.length;d={ly:d.ly},d.ly++)b=D[d.ly],B=O.G.B2(b,"json3"),C=g.RQ(B,{withCredentials:!0,format:"RAW"},3,500).then(function(L){return function(z){z={metadata:g.XD(D[L.ly]),trackData:z.xhr.responseText};U.push(z)}}(d)).Es(function(L){U6("Caption fetch error",L)}),u.push(C);
return g.E(Q,IgK(u),2);case 2:return g.Vy(Q,3),g.E(Q,n1o(N,U),5);case 5:g.Mt(Q,0);break;case 3:A=g.eo(Q),U6("Caption DB transaction error",A),g.yy(Q)}})};g.K(Hf,g.S);Hf.prototype.q5=function(){this.W&&this.W();g.S.prototype.q5.call(this)};
Hf.prototype.U=function(N){var h=this,O,u,D,U,d,b,B,C;return g.c(function(A){u=(O=N.transfer)!=null?O:new Set;D=[];U=g.I(u);for(d=U.next();!d.done;d=U.next())b=d.value,B=g.n$(b),C=B.entityId,D.push(C);return D.length===0?A.return():g.E(A,AeS(h,D),0)})};g.K(vWK,g.S);g.w=vWK.prototype;g.w.q5=function(){this.vB&&this.vB();this.TO.dispose();this.X.dispose();this.m$&&g.kx(this.V.bH,this.m$);this.FA&&g.kx(this.V.bH,this.FA);g.S.prototype.q5.call(this)};
g.w.GPi=function(N){var h=this,O,u,D;return g.c(function(U){switch(U.G){case 1:O=g.Fv(N,"transfer");if(h.G&&O===h.G.key){jF(h.B,h.L,!0);h.X.stop();U.l0(0);break}return g.E(U,Fd(h.W,{mode:"readwrite",hd:!0},function(d){return Wu(d,O,"transfer").then(function(b){if(b&&b.transferState!=="TRANSFER_STATE_COMPLETE"&&b.transferState!=="TRANSFER_STATE_FAILED")return b.transferState="TRANSFER_STATE_PAUSED_BY_USER",Y2(d,b,"transfer").then(function(){return b})})}),3);
case 3:u=U.W;if(!u){U.l0(0);break}if(!N||!h.U){U.l0(5);break}return g.E(U,Lf(N,h.U,h.W,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.E(U,Xm(h,N),7);case 7:D=U.W,y0V({videoId:N,w9:u,offlineModeType:D}),g.yy(U)}})};
g.w.eym=function(){var N=this;if(this.G&&this.L){jF(this.B,this.L,!1);var h=this.G,O=(h==null?0:h.key)?g.n$(h.key).entityId:"";O&&this.U&&(new Promise(function(u,D){Lf(O,N.U,N.W,"DOWNLOAD_STATE_PAUSED").catch(function(U){D(U)})})).catch(function(u){U6("Download state setting error",u)})}this.X.stop()};
g.w.qE=function(){this.G?m3R(this,this.G):Wf(this)};
g.w.Mm=function(N){var h=this;return g.c(function(O){switch(O.G){case 1:if(!h.G){O.l0(2);break}if(h.G.transferState==="TRANSFER_STATE_COMPLETE"||h.G.transferState==="TRANSFER_STATE_FAILED"||!N.transfer||!N.transfer.has(h.G.key)){O.l0(3);break}return g.E(O,k2(h.W,h.G.key,"transfer"),4);case 4:h.G=O.W;if(h.G){O.l0(3);break}return g.E(O,IMY(h),3);case 3:if(h.G)return O.return();case 2:return g.E(O,Wf(h),0)}})};
g.w.x5=function(N,h){var O=this,u,D,U,d,b;return g.c(function(B){switch(B.G){case 1:if(!O.G){ff(O,"onTransferFailure: "+N);B.l0(2);break}u=O.G;U=((D=u)==null?0:D.key)?g.n$(u.key).entityId:"";a:switch(N){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var C=!1;break a;default:C=!0}return C&&edY(O)?g.E(B,Yc(O,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.E(B,
EWo(O,N),5);case 5:if(!U||!O.U){B.l0(2);break}return g.E(B,Lf(U,O.U,O.W,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.E(B,Xm(O,U),9);case 9:d=B.W;Bf({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:U,w9:u,offlineModeType:d});if(!U||!O.U){B.l0(2);break}return g.E(B,Lf(U,O.U,O.W,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Tr(O),b=Wf(O,!0),h&&h(b),g.yy(B)}})};
g.w.KY=function(N){var h=this,O,u,D,U,d,b,B,C,A,Q,L,z;return g.c(function(v){switch(v.G){case 1:if(!h.G){ff(h,"onMaybeTransferStreamsExpired");v.l0(2);break}return edY(h)?g.E(v,Yc(h,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.E(v,EWo(h,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!h.U){v.l0(2);break}O=h.G;D=((u=O)==null?0:u.key)?g.n$(O.key).entityId:"";if(!D){v.l0(2);break}return g.E(v,Lf(D,h.U,h.W,"DOWNLOAD_STATE_FAILED"),2);case 9:return h.G||ff(h,"onMaybeTransferStreamsExpiredRetryAttempting"),
U=h.G,b=((d=U)==null?0:d.key)?g.n$(U.key).entityId:"",g.E(v,Xm(h,b),10);case 10:return B=v.W,Bf({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:b,w9:U,offlineModeType:B}),C=evS(),g.qs(C,rL,{isEnqueuedForExpiredStreamUrlRefetch:!0}),A=g.Fv(b,"playbackData"),Q={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:A,actionMetadata:C},L=IM(new Kf("playbackData",b,Q)),g.E(v,Z5(h.W,L,"offlineOrchestrationActionWrapperEntity"),2);case 2:Tr(h),z=Wf(h,!0),
N&&N(z),g.yy(v)}})};
var gCj={},ce5=(gCj.TRANSFER_STATE_TRANSFERRING=1,gCj.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,gCj);g.w=lJ.prototype;g.w.R4=function(){return this.L.promise};
g.w.Ei=function(){if(this.W&&this.B)return this.L.promise;gWS(this).then(this.L.resolve).catch(this.L.reject);return this.L.promise};
g.w.VM=function(N){var h={};return h.playbackData=new zGo(N,this.Qm,this.G),h.transfer=new giS(N,this.Qm),h.videoPlaybackPositionEntity=new $xV(N,this.Qm),h};
g.w.qe=function(){var N=this;return g.c(function(h){return N.W?g.E(h,wCj(N.W),0):h.l0(0)})};
g.w.kL=function(){var N=this,h,O;return g.c(function(u){if(u.G==1)return N.W||N.B?g.E(u,N.R4(),2):u.return();N.Y!==void 0&&(g.QS(N.Y),N.Y=void 0);N.X!==void 0&&(g.QS(N.X),N.X=void 0);(h=N.W)==null||h.dispose();N.W=void 0;(O=N.B)==null||O.dispose();N.B=void 0;N.api.wf("onOrchestrationLostLeader");N.L=new g.oG;g.yy(u)})};
g.w.isOrchestrationLeader=function(){return this.U.G};
g.w.Lv=function(){return g.c(function(N){return N.return(!1)})};
g.w.Fw=function(N){var h=this.G;h.api.publish("offlinetransferpause",N);var O;(O=h.W)==null||O.postMessage(N)};
g.w.qE=function(N){var h,O;return g.c(function(u){if(u.G==1)return g.E(u,hy(),2);h=u.W;if(!h)return u.return();O=g.Fv(N,"transfer");return g.E(u,Fd(h,{mode:"readwrite",hd:!0},function(D){var U=Wu(D,O,"transfer"),d=Wu(D,g.Fv(N,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w_.all([U,d]).then(function(b){b=g.I(b);var B=b.next().value;var C=b.next().value;return B&&B.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(B.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Y2(D,B,"transfer").then(function(){Bf({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:N,w9:B,offlineModeType:C==null?void 0:C.offlineModeType});return g.w_.resolve(null)})):g.w_.resolve(null)})}),0)})};
g.w.JM=function(N){N=N===void 0?43200:N;var h=this,O,u,D,U,d,b,B,C;return g.c(function(A){if(A.G==1)return h.V.rA()?g.E(A,hy(),2):A.return(reY());if(A.G!=3){O=A.W;if(!O)return A.return([]);u=Date.now()/1E3;return g.E(A,NW(O,"offlineVideoPolicy"),3)}D=A.W;U=[];d=g.I(D);for(b=d.next();!b.done;b=d.next())B=b.value,Number(B.lastUpdatedTimestampSeconds)+N<=u&&(C=g.n$(B.key).entityId,U.push(C));return U.length?A.return(xc(h,U,h.D,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):A.return([])})};
g.w.deleteAll=function(){return xc(this,["!*$_ALL_ENTITIES_!*$"],this.D,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.w.refreshAllStaleEntities=function(N){var h=this;return g.c(function(O){return O.G==1?g.E(O,h.JM(N),2):O.return(O.W)})};
g.w.setUpPositionSyncInterval=function(N){var h=this;this.X!==void 0&&(g.QS(this.X),this.X=void 0);var O=N!=null?N:864E5;this.X=g.AY(function(){h.D2(O)},O)};
g.w.D2=function(N){var h=this,O,u,D,U,d,b;return g.c(function(B){switch(B.G){case 1:return g.Vy(B,2),g.E(B,Su.getInstance(),4);case 4:O=B.W;if(!O)throw Error("prefStorage is undefined");return g.E(B,O.get("psi"),5);case 5:u=B.W;U=((D=u)==null?0:D.Qn)?Number(u.Qn)/1E3:0;d=Date.now();if(!(U+N<=d)){B.l0(6);break}return g.E(B,xc(h,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Mt(B,0);break;case 2:b=g.eo(B),U6("Offline manager error",b),
g.yy(B)}})};
g.w.aK=function(){var N=this,h,O,u,D,U,d,b;return g.c(function(B){if(B.G==1)return g.E(B,hy(),2);if(B.G!=3)return(h=B.W)?g.E(B,NW(h,"transfer"),3):B.return([]);O=B.W;u=[];D=g.I(O);for(U=D.next();!U.done;U=D.next())d=U.value,d.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&d.key&&(b=g.n$(d.key).entityId,u.push(b));return B.return(JeK(N,u))})};
g.w.f2=function(){return g.c(function(N){return N.return([])})};
g.w.WG=function(){return g.c(function(N){g.yy(N)})};
g.w.Hd=function(){return g.c(function(N){g.yy(N)})};g.K(jOj,aM);jOj.prototype.W=function(N){return Ay(N)?Tfr(this,N):oM(N)?XCY(this,N):Qw(N)?fMK(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var nf=[10];g.K(FpV,aM);FpV.prototype.W=function(N){return Ay(N)?Ntm(this,N):oM(N)?h0o(this,N):Qw(N)?Own(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var kbS=[10];g.K(Dqr,aM);Dqr.prototype.W=function(N){return oM(N)?dqS(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};g.K(G8V,lJ);g.w=G8V.prototype;g.w.VM=function(N){var h=lJ.prototype.VM.call(this,N);h.mainVideoEntity=new FpV(N,this.Qm,this.G);h.mainPlaylistEntity=new jOj(N,this.Qm,this.G);h.mainDownloadsListEntity=new Dqr(N,this.Qm,this.G);return h};
g.w.refreshAllStaleEntities=function(N,h){var O=this,u,D,U,d,b,B,C,A,Q,L,z;return g.c(function(v){switch(v.G){case 1:u=[];if(!O.Qm.j("web_player_offline_playlist_auto_refresh")){v.l0(2);break}return g.E(v,bwr(O,N,h),3);case 3:u=v.W;case 2:return g.E(v,Su.getInstance(),4);case 4:return D=v.W,g.E(v,(U=D)==null?void 0:U.get("sdois"),5);case 5:return d=v.W,g.E(v,(b=D)==null?void 0:b.get("lmqf"),6);case 6:B=v.W;if(!d){v.l0(7);break}A=u;Q=A.concat;return g.E(v,iwY(O,d,(C=B)!=null?C:"SD",N===0),8);case 8:u=
Q.call(A,v.W);case 7:return L=u,z=L.concat,g.E(v,lJ.prototype.refreshAllStaleEntities.call(O,N,h),9);case 9:return u=z.call(L,v.W),v.return(u)}})};
g.w.Lv=function(N){var h,O,u,D,U,d,b,B;return g.c(function(C){if(C.G==1)return g.E(C,hy(),2);if(C.G!=3)return(h=C.W)?g.E(C,k2(h,g.Jk,"mainDownloadsListEntity"),3):C.return(!1);O=C.W;if((u=O)==null?0:(D=u.downloads)==null?0:D.length)for(U=g.Fv(N,"mainVideoEntity"),d=g.I(O.downloads),b=d.next();!b.done;b=d.next())if(B=b.value,B.videoItem===U)return C.return(!0);return C.return(!1)})};
g.w.f2=function(){var N=this,h,O,u,D,U,d,b,B;return g.c(function(C){if(C.G==1)return g.E(C,hy(),2);if(C.G!=3)return(h=C.W)?g.E(C,NW(h,"downloadStatusEntity"),3):C.return([]);O=C.W;u=[];D=g.I(O);for(U=D.next();!U.done;U=D.next())d=U.value,d.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&d.key&&(b=g.n$(d.key).entityId,u.push(b));return u.length?(B={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},C.return(xc(N,u,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
B))):C.return([])})};
g.w.Hd=function(){var N;return g.c(function(h){return h.G==1?g.E(h,hy(),2):(N=h.W)?g.E(h,Fd(N,{mode:"readwrite",hd:!0},function(O){return Xd(O,"mainVideoEntity").then(function(u){var D=[];u=g.I(u);for(var U=u.next();!U.done;U=u.next()){U=U.value;var d=void 0;(d=U.userState)!=null&&d.playbackPosition||(d=g.n$(U.key).entityId,d={key:g.Fv(d,"videoPlaybackPositionEntity"),videoId:d,lastPlaybackPositionSeconds:"0"},D.push(Y2(O,d,"videoPlaybackPositionEntity")),U.userState={playbackPosition:d.key},D.push(Y2(O,
U,"mainVideoEntity")))}return g.w_.all(D)})}),0):h.return()})};
g.w.WG=function(){var N,h,O,u,D,U,d,b,B,C,A,Q,L,z,v,t,R,p,M,a,J,W,F,l,iY,bY,BR,oe,Oa,Ea,nx,or,CS,fx,ae,Gi,sR,XV;return g.c(function(bl){if(bl.G==1)return g.E(bl,hy(),2);if(bl.G!=3){N=bl.W;if(!N)return bl.return();h=g.Fv("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.E(bl,Fd(N,{mode:"readonly",hd:!0},function(e){return g.w_.all([Wu(e,h,"mainDownloadsListEntity"),Wu(e,g.Jk,"mainDownloadsListEntity"),Xd(e,"mainVideoEntity"),Xd(e,"mainPlaylistEntity")])}),3)}O=bl.W;
u=g.I(O);D=u.next().value;U=u.next().value;d=u.next().value;b=u.next().value;B=D;C=U;A=d;Q=b;L=new Set;if((z=B)==null?0:(v=z.downloads)==null?0:v.length)for(t=g.I(B.downloads),R=t.next();!R.done;R=t.next())p=R.value,M=void 0,(a=(M=p.videoItem)!=null?M:p.playlistItem)&&L.add(a);if((J=C)==null?0:(W=J.downloads)==null?0:W.length)for(F=g.I(C.downloads),l=F.next();!l.done;l=F.next())iY=l.value,iY.videoItem&&L.add(iY.videoItem);bY=new Set;BR=[];oe=g.I(Q);for(Oa=oe.next();!Oa.done;Oa=oe.next()){Ea=Oa.value;
if(Ea.videos)for(nx=g.I(Ea.videos),or=nx.next();!or.done;or=nx.next())CS=or.value,(fx=JSON.parse(g.n$(CS).entityId).videoId)&&bY.add(fx);Ea.key&&!L.has(Ea.key)&&BR.push(Ea.key)}ae=g.I(A);for(Gi=ae.next();!Gi.done;Gi=ae.next())sR=Gi.value,sR.key&&!L.has(sR.key)&&(XV=g.n$(sR.key).entityId,bY.has(XV)||BR.push(sR.key));return BR.length?g.E(bl,WDr(N,BR),0):bl.l0(0)})};g.K(Bt5,aM);Bt5.prototype.W=function(N){return Ay(N)?AYS(this,N):oM(N)?oCY(this,N):Qw(N)?QQj(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var Zk=[10];g.K(z05,aM);z05.prototype.W=function(N){return Ay(N)?wYo(this,N):oM(N)?KbR(this,N):Qw(N)?mqY(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var kc=[10];g.K($qx,aM);$qx.prototype.W=function(N){return Ay(N)?PFV(this,N):oM(N)?Msr(this,N):Qw(N)?pYo(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var R05=[10];g.K(N6,lJ);N6.prototype.VM=function(N){var h=lJ.prototype.VM.call(this,N);h.musicTrack=new $qx(N,this.G);h.musicPlaylist=new z05(N,this.G);h.musicAlbumRelease=new Bt5(N,this.G);return h};
N6.prototype.refreshAllStaleEntities=function(N,h){var O=this,u,D,U;return g.c(function(d){if(d.G==1)return g.E(d,ECS(O,N,h),2);if(d.G!=3)return D=u=d.W,U=D.concat,g.E(d,lJ.prototype.refreshAllStaleEntities.call(O,N,h),3);u=U.call(D,d.W);return d.return(u)})};g.K(cY5,g.Vq);g.w=cY5.prototype;g.w.create=function(){var N=this;g.H(this,this.events);if(g.yv(this.Qm))this.G=new G8V(this.Qm,this.player);else if(g.qG(this.Qm)||g.Rt(this.Qm))this.G=new N6(this.Qm,this.player);this.events.J(this.player,"onPlaybackStartExternal",function(){N.HR()});
this.events.J(this.player,"videodatachange",function(){N.HR()});
this.Qm.j("html5_offline_playback_position_sync")&&this.events.J(this.player,"presentingplayerstatechange",this.a4)};
g.w.w6=function(){return!1};
g.w.AX=function(N,h,O,u){var D=this;return g.c(function(U){return D.G?U.return(xc(D.G,N,h,O,u)):U.return(Promise.reject())})};
g.w.deleteAll=function(){return this.G.deleteAll()};
g.w.JM=function(N){return this.G.JM(N)};
g.w.refreshAllStaleEntities=function(N){return this.G.refreshAllStaleEntities(N)};
g.w.setUpPositionSyncInterval=function(N){this.G.setUpPositionSyncInterval(N)};
g.w.Fw=function(N){this.G.Fw(N)};
g.w.qE=function(N){return this.G.qE(N)};
g.w.HR=function(){var N=this,h;return g.c(function(O){h=N.player.getVideoData();return g.my(h)?aux(h)&&N.W!==h.clientPlaybackNonce?g.E(O,qUS(N,h),0):O.l0(0):O.return()})};
g.w.a4=function(N){var h=this,O,u,D,U,d,b,B;return g.c(function(C){if(C.G==1)return O=h.player.getVideoData(),u=O.XV,g.Ar(N,2)||g.Ar(N,512)?g.E(C,hy(),2):C.return();if(C.G!=3){D=C.W;if(!D)return U6("PES is undefined"),C.return();U=O.videoId;return g.E(C,k2(D,g.Fv(U,"mainVideoEntity"),"mainVideoEntity"),3)}d=C.W;if(!d)return C.return();b=Math.floor(u).toString();B={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:b}};return g.E(C,h.AX([U],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
B),0)})};
g.w.isOrchestrationLeader=function(){return this.G.isOrchestrationLeader()};
g.w.updateDownloadState=function(N,h){var O,u,D,U;return g.c(function(d){if(d.G==1)return g.E(d,hy(),2);O=d.W;if(!O)return U6("PES is undefined"),d.return();u=g.n$(N);D=u.entityType;U=u.entityId;return g.E(d,Lf(U,D,O,h,!0),0)})};g.yq("offline",cY5);})(_yt_player);
